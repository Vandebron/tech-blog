<!DOCTYPE html><html lang="en"><head><script async="" src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="https://d381m57et8llfk.cloudfront.net/20210128-6054/static/css/dc7f55cf12b36887a247.fonts.css"/><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
                ga('create', 'UA-49472651-19', { 'storage': 'none' });
                ga('send', 'pageview');</script><script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js" crossorigin="anonymous"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Cassandra, it’s not you, it’s us</title><meta name="Description" content="Our Journey to find the perfect data storage solution for us"/><meta property="og:title" content="Cassandra, it’s not you, it’s us"/><meta property="og:description" content="Our Journey to find the perfect data storage solution for us"/><meta property="og:image" content="https://www.vandebron.tech/images/heart-breaking.jpg"/><meta name="next-head-count" content="7"/><link rel="preload" href="/pr-preview/pr-47/_next/static/css/cd9ae78b876ddb947f31.css" as="style"/><link rel="stylesheet" href="/pr-preview/pr-47/_next/static/css/cd9ae78b876ddb947f31.css" data-n-g=""/><link rel="preload" href="/pr-preview/pr-47/_next/static/css/7523c8b3ab0d1496040c.css" as="style"/><link rel="stylesheet" href="/pr-preview/pr-47/_next/static/css/7523c8b3ab0d1496040c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/webpack-0b9cc56c94819e8023ea.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/framework.87b9127d6cd191ae1c9a.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.4f04f20a6eec7675b717.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/main-419ac17f185f95278b96.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/7b9503d2.4af90216c47085b5c8e9.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/ad364940.a83a6a4548b93404854d.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/226daff62b2d4bc1e9a7210a7f6000a544319a74.fbdd4d016a5c47ddc9db.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/pages/_app-efc965c1f8dfb605c86b.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/1c49f5f00355f650bee3d37484f094be037a30fa.0c099ecf2acefc71ba39.js" as="script"/><link rel="preload" href="/pr-preview/pr-47/_next/static/chunks/pages/blog/%5Bslug%5D-b632a95a3dd851871cd0.js" as="script"/></head><body><div id="__next"><div class="Container-module__container" as="header" style="padding-top:30px;padding-bottom:30px;margin-bottom:30px"><div class="Row-module__row Row-module__align-items-center Row-module__justify-content-between"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12 Col-module__col-md-auto Col-module__col-lg-auto Col-module__col-sm-12"><div><div style="cursor:pointer;user-select:none;display:flex;align-items:baseline"><svg width="140" viewBox="0 0 140 22" xmlns="http://www.w3.org/2000/svg"><path d="M9.569 21.109h-4.25L0 6.274h4.597l2.86 9.249 2.86-9.249h4.598L9.57 21.11m13.234-4.258a3.159 3.159 0 0 1 0-6.316 3.156 3.156 0 0 1 3.144 2.884v.543a3.157 3.157 0 0 1-3.144 2.889m3.2-9.81a7.38 7.38 0 1 0 0 13.3c.136.425.537.73 1.003.73h3.174V6.313h-3.174c-.466 0-.867.304-1.003.728m64.522 3.567a3.155 3.155 0 0 0-3.141 2.888v.542a3.155 3.155 0 0 0 3.14 2.885 3.16 3.16 0 0 0 3.165-3.157 3.163 3.163 0 0 0-3.164-3.158m0 10.536a7.337 7.337 0 0 1-3.195-.727 1.056 1.056 0 0 1-1.006.727h-3.171V0h4.23v7.09a7.377 7.377 0 0 1 10.522 6.676c.001 4.074-3.298 7.378-7.38 7.378m26.406-4.22a3.155 3.155 0 0 1-3.141-2.886v-.542a3.155 3.155 0 0 1 3.141-2.888 3.163 3.163 0 0 1 3.164 3.159 3.161 3.161 0 0 1-3.164 3.156m.012-10.511c-5.054 0-7.481 3.978-7.481 7.356v.025c0 3.402 2.427 7.38 7.48 7.38 5.054 0 7.48-3.978 7.48-7.38 0-3.403-2.426-7.381-7.48-7.381m-60.448 4.196a3.155 3.155 0 0 1 3.141 2.888v.542a3.156 3.156 0 0 1-3.141 2.885 3.16 3.16 0 0 1-3.165-3.157 3.163 3.163 0 0 1 3.165-3.158m0 10.536a7.377 7.377 0 0 1-7.381-7.378A7.377 7.377 0 0 1 59.635 7.09V0h4.23v21.144h-3.17c-.473 0-.866-.303-1.006-.727a7.342 7.342 0 0 1-3.195.727zm51.349-14.856v4.222a3.074 3.074 0 0 0-.244-.013c-1.64 0-3.138 1.057-3.138 2.585v8.025h-4.234V6.276h3.17c.473 0 .867.303 1.006.727a7.353 7.353 0 0 1 3.196-.727c.082 0 .162.01.244.012zm25.525 4.21c-1.467 0-2.348.886-2.348 2.584v8.09h-4.285V6.277h3.172c.472 0 .865.304 1.005.727a7.347 7.347 0 0 1 3.195-.727s1.239-.059 2.514.343c3.027.904 3.379 3.962 3.379 5.599v8.955h-4.284v-8.091c0-.883-.205-2.585-2.348-2.585zm-93.333 0c-1.467 0-2.348.886-2.348 2.584v8.09h-4.284V6.277h3.17c.474 0 .866.304 1.006.727a7.354 7.354 0 0 1 3.196-.727s1.239-.059 2.514.343c3.028.904 3.378 3.962 3.378 5.599v8.955h-4.284v-8.091c0-.883-.204-2.585-2.348-2.585zm36.24 1.755h-5.453c-.116-.003-.55-.055-.325-.637a3.336 3.336 0 0 1 6.134.093c.147.495-.246.541-.356.544m2.55-3.796c-1.308-1.384-3.145-2.214-5.284-2.214-4.254 0-7.324 3.598-7.324 7.5 0 4.15 3.398 7.398 7.399 7.398a6.789 6.789 0 0 0 3.976-1.258c1.183-.806 2.165-2.013 2.844-3.574h-4.278c-.503.73-1.208 1.31-2.542 1.31-1.635 0-3.045-.983-3.22-2.468h10.393c.327-2.566-.202-4.806-1.964-6.694" fill="#333D47" fill-rule="evenodd"></path></svg> <span class="Text-module__text-default Text-module__u-font-h3 Text-module__u-font-color-green" style="font-size:28px;margin:0;line-height:auto">.tech</span></div></div></div><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12 Col-module__col-md-auto Col-module__col-lg-auto Col-module__col-sm-12"><div class="Flex-module__d-flex Flex-module__flex-row Flex-module__align-items-stretch Flex-module__justify-content-start Flex-module__justify-content-sm-between"><ul class="Navigation-module__navigation-wrapper" id="styled-navigation" style="margin-right:25px"><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link Navigation-module__navigation-link-active" name="Home" url="/"><span>Home</span></a></li><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link" name="About" url="/about"><span>About</span></a></li><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link" name="vandebron.nl" url="https://vandebron.nl"><span>vandebron.nl</span></a></li><div class="Navigation-module__navigation-magic-line" style="transition:none;left:0;width:0"></div></ul><div><a class="Pressable-module__button Pressable-module__text" href="https://github.com/vandebron/" target="_blank" rel="noreferrer" style="margin-right:10px"><svg role="img" viewBox="0 0 24 24" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">Vandebron on Github</span></a><a class="Pressable-module__button Pressable-module__text" href="https://dev.to/vandebron/" target="_blank" rel="noreferrer" style="margin-right:10px"><svg viewBox="0 0 448 512" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"></path></svg><span class="visually-hidden">Vandebron on Dev.to</span></a><a class="Pressable-module__button Pressable-module__text" href="https://medium.com/vandebron/" target="_blank" rel="noreferrer"><svg viewBox="0 0 448 512" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><path fill="currentColor" d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"></path></svg><span class="visually-hidden">Vandebron on Medium</span></a></div></div></div></div></div><div class="Container-module__container"><div class="Row-module__row"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><h2 class="Text-module__text-default Text-module__u-font-h2">Cassandra, it’s not you, it’s us</h2></div><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><p class="Text-module__text-default Text-module__u-font-body"><span class="Text-module__text-default">By Tomás Phelan on 16 februari 2024</span></p></div></div><div class="Row-module__row"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><p class="Text-module__text-default Text-module__u-font-body"><div class="Image-module__image-container" style="padding-bottom:50%"><div style="height:200px" class="lazyload-placeholder"></div></div></p></div></div><div class="Row-module__row" style="margin-bottom:60px"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><h1 class="Text-module__text-default Text-module__u-font-h1">Cassandra, it’s not you, it’s us</h1>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">I want you to know that you are probably an amazing product that has so much to offer to the world. However, it sadly just isn’t working out for us anymore.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">We&#x27;ve encountered challenges such as escalating costs, inconsistent write and read performances, and setup misalignments that have constrained our growth. Of course, this is not entirely your fault, we set you up to fail with our infrastructure and use cases.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">I hope we can part on good terms, with mutual respect and appreciation for the time we shared.<br/>
I wish you all the happiness, success, and fulfilment in the world, and I hope you find a company that complements your life in the way you deserve.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Thank you for understanding, and I truly wish you the best.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Yours truly, Vandebron</p>
<h2 class="Text-module__text-default Text-module__u-font-h2">Our Data Storage Prince Charming</h2>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]"><img src="../images/data-prince-charming.jpg" alt="data-prince-charming.jpg" style="width:100%" title="Data Prince" node="[object Object]"/></p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">A list of some of the qualities we are looking for:</p>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Kindness and compassion.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">High availability.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Low Maintenance.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Ability to store large volumes of data (currently around 10TB), though not everything has to be queried fast.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Capable of ingesting real-time energy usage data (every 15 minutes per customer, possibly higher frequency in the future).</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Ideally, we can use our current tech stack as much as possible (flyway migrations, roundtrip tests, spark).</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Ideally, use as few different database technologies as possible.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">It does not need to be horizontally scalable, due to moving from 1 central data storage to a separate data storage per service.</li>
</ol>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">With enough work, time and commitment, Cassandra could have fulfilled most of these requirements. However, love is a two-way street, and we didn&#x27;t put in the time and effort to make it work.</p>
<h2 class="Text-module__text-default Text-module__u-font-h2">Speed Dating Round</h2>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Some potential suitors we considered for replacing Cassandra:</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">ScyllaDB</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">ScyllaDB is very similar to Cassandra. It should have better performance but still have (almost) all the same functionality as Cassandra.</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">PostgreSQL</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">PostgreSQL is a relational database. We already use it extensively in our services.</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">Cockroach</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">It is similar to PostgreSQL but with some limitations: <a href="https://www.cockroachlabs.com/docs/stable/known-limitations.html" node="[object Object]" style="color:inherit" target="_blank">Known Limitations in CockroachDB v23.2</a></p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">It is horizontally scalable, which is an advantage over PostgreSQL when it comes to high availability and fault tolerance. We are also currently using it in some of our services.</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">Timescale</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Timescale is a PostgreSQL extension that uses the same query layer, but a different storage layer, to have efficient time series-related features.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">It can also distribute data, but this is still in early access and is not recommended.</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">Yugabyte</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Yugabyte is a PostgreSQL extension to make PostgreSQL into a distributed database.</p>
<h2 class="Text-module__text-default Text-module__u-font-h2">Comparisons</h2>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">To determine the most suitable match, we did some quick performance tests. One where we inserted 2 million + weather data records as fast as possible via recurring inserts, to see how easy it would be to migrate over to. And another test to determine general query speed.</p>
<h3 class="Text-module__text-default Text-module__u-font-h3">Write Speed Results</h3>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]"><img src="../images/insert-perf-database.jpg" alt="insert-perf-database.jpg" style="width:100%" title="Insert Graph" node="[object Object]"/></p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Note that the test results are not 100% fair, because Timescale and Postgres don’t have to distribute the data over multiple nodes (though Timescale does have 2 replicas), and Cassandra already contained a lot of data (though with some testing timescale didn’t seem to become slower when it already had more data). For Yugabyte and Cockroach, we gave up after 1 hour. Also, the tests were done with the existing setup for Cassandra.</p>
<h3 class="Text-module__text-default Text-module__u-font-h3">Query Speed Results</h3>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]"><img src="../images/query-perf-database.jpg" alt="query-perf-database.jpg" style="width:100%" title="Query Graph" node="[object Object]"/></p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">We also did some tests to query aggregated data from streaming data.</p>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">For this, we copied over 2.6M rows to each database.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">For this data we need to aggregate (sum) some values per 15-minute time block).</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">For Cassandra/Scylla, this is done via spark.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">For timescale use buckets based on timestamps.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">For Postgres by grouping on floor(extract(epoch from timestamp) / 60 / 15)</li>
</ol>
<h2 class="Text-module__text-default Text-module__u-font-h2">Our Happily Ever After</h2>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Timescale emerged as the clear winner here, not just for its performance in the above tests, but also for its seamless integration with our existing PostgreSQL setup. This compatibility allows us to maintain our current libraries and reduce code complexity, making Timescale an ideal choice for our time series data. At the same time, we continue to rely on Postgres for our other needs.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Cassandra, you won’t be missed.</p></div></div></div><footer style="padding-top:30px;padding-bottom:30px;background-color:#363639"><div class="Container-module__container"><div class="Row-module__row Row-module__align-items-center" style="margin-bottom:15px"><div class="Col-module__col-box-sizing Col-module__col"><div><div style="cursor:pointer;user-select:none;display:flex;align-items:baseline"><svg width="140" viewBox="0 0 140 22" xmlns="http://www.w3.org/2000/svg"><path d="M9.569 21.109h-4.25L0 6.274h4.597l2.86 9.249 2.86-9.249h4.598L9.57 21.11m13.234-4.258a3.159 3.159 0 0 1 0-6.316 3.156 3.156 0 0 1 3.144 2.884v.543a3.157 3.157 0 0 1-3.144 2.889m3.2-9.81a7.38 7.38 0 1 0 0 13.3c.136.425.537.73 1.003.73h3.174V6.313h-3.174c-.466 0-.867.304-1.003.728m64.522 3.567a3.155 3.155 0 0 0-3.141 2.888v.542a3.155 3.155 0 0 0 3.14 2.885 3.16 3.16 0 0 0 3.165-3.157 3.163 3.163 0 0 0-3.164-3.158m0 10.536a7.337 7.337 0 0 1-3.195-.727 1.056 1.056 0 0 1-1.006.727h-3.171V0h4.23v7.09a7.377 7.377 0 0 1 10.522 6.676c.001 4.074-3.298 7.378-7.38 7.378m26.406-4.22a3.155 3.155 0 0 1-3.141-2.886v-.542a3.155 3.155 0 0 1 3.141-2.888 3.163 3.163 0 0 1 3.164 3.159 3.161 3.161 0 0 1-3.164 3.156m.012-10.511c-5.054 0-7.481 3.978-7.481 7.356v.025c0 3.402 2.427 7.38 7.48 7.38 5.054 0 7.48-3.978 7.48-7.38 0-3.403-2.426-7.381-7.48-7.381m-60.448 4.196a3.155 3.155 0 0 1 3.141 2.888v.542a3.156 3.156 0 0 1-3.141 2.885 3.16 3.16 0 0 1-3.165-3.157 3.163 3.163 0 0 1 3.165-3.158m0 10.536a7.377 7.377 0 0 1-7.381-7.378A7.377 7.377 0 0 1 59.635 7.09V0h4.23v21.144h-3.17c-.473 0-.866-.303-1.006-.727a7.342 7.342 0 0 1-3.195.727zm51.349-14.856v4.222a3.074 3.074 0 0 0-.244-.013c-1.64 0-3.138 1.057-3.138 2.585v8.025h-4.234V6.276h3.17c.473 0 .867.303 1.006.727a7.353 7.353 0 0 1 3.196-.727c.082 0 .162.01.244.012zm25.525 4.21c-1.467 0-2.348.886-2.348 2.584v8.09h-4.285V6.277h3.172c.472 0 .865.304 1.005.727a7.347 7.347 0 0 1 3.195-.727s1.239-.059 2.514.343c3.027.904 3.379 3.962 3.379 5.599v8.955h-4.284v-8.091c0-.883-.205-2.585-2.348-2.585zm-93.333 0c-1.467 0-2.348.886-2.348 2.584v8.09h-4.284V6.277h3.17c.474 0 .866.304 1.006.727a7.354 7.354 0 0 1 3.196-.727s1.239-.059 2.514.343c3.028.904 3.378 3.962 3.378 5.599v8.955h-4.284v-8.091c0-.883-.204-2.585-2.348-2.585zm36.24 1.755h-5.453c-.116-.003-.55-.055-.325-.637a3.336 3.336 0 0 1 6.134.093c.147.495-.246.541-.356.544m2.55-3.796c-1.308-1.384-3.145-2.214-5.284-2.214-4.254 0-7.324 3.598-7.324 7.5 0 4.15 3.398 7.398 7.399 7.398a6.789 6.789 0 0 0 3.976-1.258c1.183-.806 2.165-2.013 2.844-3.574h-4.278c-.503.73-1.208 1.31-2.542 1.31-1.635 0-3.045-.983-3.22-2.468h10.393c.327-2.566-.202-4.806-1.964-6.694" fill="#ffffff" fill-rule="evenodd"></path></svg> <span class="Text-module__text-default Text-module__u-font-h3 Text-module__u-font-color-green" style="font-size:28px;margin:0;line-height:auto">.tech</span></div></div></div></div><div class="Row-module__row Row-module__align-items-center"><div class="Col-module__col-box-sizing Col-module__col"><span class="Text-module__text-default" style="color:white">© Vandebron</span></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\n# Cassandra, it’s not you, it’s us\n\nI want you to know that you are probably an amazing product that has so much to offer to the world. However, it sadly just isn’t working out for us anymore.\n\nWe've encountered challenges such as escalating costs, inconsistent write and read performances, and setup misalignments that have constrained our growth. Of course, this is not entirely your fault, we set you up to fail with our infrastructure and use cases.\n\nI hope we can part on good terms, with mutual respect and appreciation for the time we shared.  \nI wish you all the happiness, success, and fulfilment in the world, and I hope you find a company that complements your life in the way you deserve.\n\nThank you for understanding, and I truly wish you the best.\n\nYours truly, Vandebron\n\n## Our Data Storage Prince Charming\n![data-prince-charming.jpg](../images/data-prince-charming.jpg \"Data Prince\")\n\nA list of some of the qualities we are looking for:\n- Kindness and compassion. \n- High availability.\n- Low Maintenance.\n- Ability to store large volumes of data (currently around 10TB), though not everything has to be queried fast.\n- Capable of ingesting real-time energy usage data (every 15 minutes per customer, possibly higher frequency in the future).\n- Ideally, we can use our current tech stack as much as possible (flyway migrations, roundtrip tests, spark).\n- Ideally, use as few different database technologies as possible.\n- It does not need to be horizontally scalable, due to moving from 1 central data storage to a separate data storage per service.\n\nWith enough work, time and commitment, Cassandra could have fulfilled most of these requirements. However, love is a two-way street, and we didn't put in the time and effort to make it work.\n\n## Speed Dating Round\nSome potential suitors we considered for replacing Cassandra:\n\n#### ScyllaDB\nScyllaDB is very similar to Cassandra. It should have better performance but still have (almost) all the same functionality as Cassandra.\n\n#### PostgreSQL\nPostgreSQL is a relational database. We already use it extensively in our services.\n\n#### Cockroach\nIt is similar to PostgreSQL but with some limitations: [Known Limitations in CockroachDB v23.2](https://www.cockroachlabs.com/docs/stable/known-limitations.html)\n\nIt is horizontally scalable, which is an advantage over PostgreSQL when it comes to high availability and fault tolerance. We are also currently using it in some of our services.\n\n#### Timescale\nTimescale is a PostgreSQL extension that uses the same query layer, but a different storage layer, to have efficient time series-related features.\n\nIt can also distribute data, but this is still in early access and is not recommended.\n\n#### Yugabyte\n\nYugabyte is a PostgreSQL extension to make PostgreSQL into a distributed database.\n\n## Comparisons\n\nTo determine the most suitable match, we did some quick performance tests. One where we inserted 2 million + weather data records as fast as possible via recurring inserts, to see how easy it would be to migrate over to. And another test to determine general query speed.\n\n### Write Speed Results\n![insert-perf-database.jpg](../images/insert-perf-database.jpg \"Insert Graph\")\n\nNote that the test results are not 100% fair, because Timescale and Postgres don’t have to distribute the data over multiple nodes (though Timescale does have 2 replicas), and Cassandra already contained a lot of data (though with some testing timescale didn’t seem to become slower when it already had more data). For Yugabyte and Cockroach, we gave up after 1 hour. Also, the tests were done with the existing setup for Cassandra.\n\n### Query Speed Results\n![query-perf-database.jpg](../images/query-perf-database.jpg \"Query Graph\")\n\nWe also did some tests to query aggregated data from streaming data.\n-   For this, we copied over 2.6M rows to each database.\n-   For this data we need to aggregate (sum) some values per 15-minute time block).\n-   For Cassandra/Scylla, this is done via spark.\n-   For timescale use buckets based on timestamps.\n-   For Postgres by grouping on floor(extract(epoch from timestamp) / 60 / 15)\n\n## Our Happily Ever After\n\nTimescale emerged as the clear winner here, not just for its performance in the above tests, but also for its seamless integration with our existing PostgreSQL setup. This compatibility allows us to maintain our current libraries and reduce code complexity, making Timescale an ideal choice for our time series data. At the same time, we continue to rely on Postgres for our other needs.\n\nCassandra, you won’t be missed.","meta":{"title":"Cassandra, it’s not you, it’s us","description":"Our Journey to find the perfect data storage solution for us","createdAt":"Fri Feb 16 2024 00:00:00 GMT+0000 (Coordinated Universal Time)","coverImage":"images/heart-breaking.jpg","tags":["cassandra","timescale","postgresql"],"author":"Tomás Phelan","slug":"blog/cassandra-its-not-you-its-us","formattedDate":"16 februari 2024","date":"Fri Feb 16 2024 00:00:00 GMT+0000 (Coordinated Universal Time)"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"cassandra-its-not-you-its-us"},"buildId":"WG2Vf9yTOAgpayujGswEG","assetPrefix":"/pr-preview/pr-47","isFallback":false,"gsp":true}</script><script nomodule="" src="/pr-preview/pr-47/_next/static/chunks/polyfills-28654a8145d7603786fc.js"></script><script src="/pr-preview/pr-47/_next/static/chunks/webpack-0b9cc56c94819e8023ea.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/framework.87b9127d6cd191ae1c9a.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.4f04f20a6eec7675b717.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/main-419ac17f185f95278b96.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/7b9503d2.4af90216c47085b5c8e9.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/ad364940.a83a6a4548b93404854d.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/226daff62b2d4bc1e9a7210a7f6000a544319a74.fbdd4d016a5c47ddc9db.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/pages/_app-efc965c1f8dfb605c86b.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/1c49f5f00355f650bee3d37484f094be037a30fa.0c099ecf2acefc71ba39.js" async=""></script><script src="/pr-preview/pr-47/_next/static/chunks/pages/blog/%5Bslug%5D-b632a95a3dd851871cd0.js" async=""></script><script src="/pr-preview/pr-47/_next/static/WG2Vf9yTOAgpayujGswEG/_buildManifest.js" async=""></script><script src="/pr-preview/pr-47/_next/static/WG2Vf9yTOAgpayujGswEG/_ssgManifest.js" async=""></script></body></html>