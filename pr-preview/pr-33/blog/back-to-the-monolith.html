<!DOCTYPE html><html lang="en"><head><script async="" src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="https://d381m57et8llfk.cloudfront.net/20210128-6054/static/css/dc7f55cf12b36887a247.fonts.css"/><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
                ga('create', 'UA-49472651-19', { 'storage': 'none' });
                ga('send', 'pageview');</script><script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>So, back to the monolith it is then?</title><meta name="Description" content="A recent Amazon article explaining how they managed to save costs by merging some of their services has lead some to question the value of microservices. What is our take?"/><meta property="og:title" content="So, back to the monolith it is then?"/><meta property="og:description" content="A recent Amazon article explaining how they managed to save costs by merging some of their services has lead some to question the value of microservices. What is our take?"/><meta property="og:image" content="https://www.vandebron.tech/images/monolith.webp"/><meta name="next-head-count" content="7"/><link rel="preload" href="/pr-preview/pr-33/_next/static/css/f21f13bbd0dcf4e9a192.css" as="style"/><link rel="stylesheet" href="/pr-preview/pr-33/_next/static/css/f21f13bbd0dcf4e9a192.css" data-n-g=""/><link rel="preload" href="/pr-preview/pr-33/_next/static/css/93bdda6e46afdf643a2d.css" as="style"/><link rel="stylesheet" href="/pr-preview/pr-33/_next/static/css/93bdda6e46afdf643a2d.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/webpack-0b9cc56c94819e8023ea.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/framework.87b9127d6cd191ae1c9a.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.e3444f50a0a795e3eeb2.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/main-419ac17f185f95278b96.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/7b9503d2.4af90216c47085b5c8e9.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/0357a89c.a83a6a4548b93404854d.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/226daff62b2d4bc1e9a7210a7f6000a544319a74.fbdd4d016a5c47ddc9db.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/pages/_app-fdd34d89c08fa14a1e57.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/1c49f5f00355f650bee3d37484f094be037a30fa.0c099ecf2acefc71ba39.js" as="script"/><link rel="preload" href="/pr-preview/pr-33/_next/static/chunks/pages/blog/%5Bslug%5D-b9610da0b3e709e6b9cf.js" as="script"/></head><body><div id="__next"><div class="Container-module__container" as="header" style="padding-top:30px;padding-bottom:30px;margin-bottom:30px"><div class="Row-module__row Row-module__align-items-center Row-module__justify-content-between"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12 Col-module__col-md-auto Col-module__col-lg-auto Col-module__col-sm-12"><div><div style="cursor:pointer;user-select:none;display:flex;align-items:baseline"><svg width="140" viewBox="0 0 140 22" xmlns="http://www.w3.org/2000/svg"><path d="M9.569 21.109h-4.25L0 6.274h4.597l2.86 9.249 2.86-9.249h4.598L9.57 21.11m13.234-4.258a3.159 3.159 0 0 1 0-6.316 3.156 3.156 0 0 1 3.144 2.884v.543a3.157 3.157 0 0 1-3.144 2.889m3.2-9.81a7.38 7.38 0 1 0 0 13.3c.136.425.537.73 1.003.73h3.174V6.313h-3.174c-.466 0-.867.304-1.003.728m64.522 3.567a3.155 3.155 0 0 0-3.141 2.888v.542a3.155 3.155 0 0 0 3.14 2.885 3.16 3.16 0 0 0 3.165-3.157 3.163 3.163 0 0 0-3.164-3.158m0 10.536a7.337 7.337 0 0 1-3.195-.727 1.056 1.056 0 0 1-1.006.727h-3.171V0h4.23v7.09a7.377 7.377 0 0 1 10.522 6.676c.001 4.074-3.298 7.378-7.38 7.378m26.406-4.22a3.155 3.155 0 0 1-3.141-2.886v-.542a3.155 3.155 0 0 1 3.141-2.888 3.163 3.163 0 0 1 3.164 3.159 3.161 3.161 0 0 1-3.164 3.156m.012-10.511c-5.054 0-7.481 3.978-7.481 7.356v.025c0 3.402 2.427 7.38 7.48 7.38 5.054 0 7.48-3.978 7.48-7.38 0-3.403-2.426-7.381-7.48-7.381m-60.448 4.196a3.155 3.155 0 0 1 3.141 2.888v.542a3.156 3.156 0 0 1-3.141 2.885 3.16 3.16 0 0 1-3.165-3.157 3.163 3.163 0 0 1 3.165-3.158m0 10.536a7.377 7.377 0 0 1-7.381-7.378A7.377 7.377 0 0 1 59.635 7.09V0h4.23v21.144h-3.17c-.473 0-.866-.303-1.006-.727a7.342 7.342 0 0 1-3.195.727zm51.349-14.856v4.222a3.074 3.074 0 0 0-.244-.013c-1.64 0-3.138 1.057-3.138 2.585v8.025h-4.234V6.276h3.17c.473 0 .867.303 1.006.727a7.353 7.353 0 0 1 3.196-.727c.082 0 .162.01.244.012zm25.525 4.21c-1.467 0-2.348.886-2.348 2.584v8.09h-4.285V6.277h3.172c.472 0 .865.304 1.005.727a7.347 7.347 0 0 1 3.195-.727s1.239-.059 2.514.343c3.027.904 3.379 3.962 3.379 5.599v8.955h-4.284v-8.091c0-.883-.205-2.585-2.348-2.585zm-93.333 0c-1.467 0-2.348.886-2.348 2.584v8.09h-4.284V6.277h3.17c.474 0 .866.304 1.006.727a7.354 7.354 0 0 1 3.196-.727s1.239-.059 2.514.343c3.028.904 3.378 3.962 3.378 5.599v8.955h-4.284v-8.091c0-.883-.204-2.585-2.348-2.585zm36.24 1.755h-5.453c-.116-.003-.55-.055-.325-.637a3.336 3.336 0 0 1 6.134.093c.147.495-.246.541-.356.544m2.55-3.796c-1.308-1.384-3.145-2.214-5.284-2.214-4.254 0-7.324 3.598-7.324 7.5 0 4.15 3.398 7.398 7.399 7.398a6.789 6.789 0 0 0 3.976-1.258c1.183-.806 2.165-2.013 2.844-3.574h-4.278c-.503.73-1.208 1.31-2.542 1.31-1.635 0-3.045-.983-3.22-2.468h10.393c.327-2.566-.202-4.806-1.964-6.694" fill="#333D47" fill-rule="evenodd"></path></svg>¬†<span class="Text-module__text-default Text-module__u-font-h3 Text-module__u-font-color-green" style="font-size:28px;margin:0;line-height:auto">.tech</span></div></div></div><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12 Col-module__col-md-auto Col-module__col-lg-auto Col-module__col-sm-12"><div class="Flex-module__d-flex Flex-module__flex-row Flex-module__align-items-stretch Flex-module__justify-content-start Flex-module__justify-content-sm-between"><ul class="Navigation-module__navigation-wrapper" id="styled-navigation" style="margin-right:25px"><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link Navigation-module__navigation-link-active" name="Home" url="/"><span>Home</span></a></li><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link" name="About" url="/about"><span>About</span></a></li><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link" name="vandebron.nl" url="https://vandebron.nl"><span>vandebron.nl</span></a></li><div class="Navigation-module__navigation-magic-line" style="transition:none;left:0;width:0"></div></ul><div><a class="Pressable-module__button Pressable-module__text" href="https://github.com/vandebron/" target="_blank" rel="noreferrer" style="margin-right:10px"><svg role="img" viewBox="0 0 24 24" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">Vandebron on Github</span></a><a class="Pressable-module__button Pressable-module__text" href="https://dev.to/vandebron/" target="_blank" rel="noreferrer" style="margin-right:10px"><svg viewBox="0 0 448 512" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"></path></svg><span class="visually-hidden">Vandebron on Dev.to</span></a><a class="Pressable-module__button Pressable-module__text" href="https://medium.com/vandebron/" target="_blank" rel="noreferrer"><svg viewBox="0 0 448 512" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><path fill="currentColor" d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"></path></svg><span class="visually-hidden">Vandebron on Medium</span></a></div></div></div></div></div><div class="Container-module__container"><div class="Row-module__row"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><h2 class="Text-module__text-default Text-module__u-font-h2">So, back to the monolith it is then?</h2></div><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><p class="Text-module__text-default Text-module__u-font-body"><span class="Text-module__text-default">By Sam Theisens on 20 mei 2023</span></p></div></div><div class="Row-module__row"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><p class="Text-module__text-default Text-module__u-font-body"><div class="Image-module__image-container" style="padding-bottom:50%"><div style="height:200px" class="lazyload-placeholder"></div></div></p></div></div><div class="Row-module__row" style="margin-bottom:60px"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><h3 class="Text-module__text-default Text-module__u-font-h3">Amazon embraces the mighty monolith</h3>
<img src="/images/step-functions.webp" alt="image alt text" style="width:50%;float:left;padding:5px" node="[object Object]"/>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">In March 2023, Amazon published a <a href="https://www.primevideotech.com/video-streaming/scaling-up-the-prime-video-audio-video-monitoring-service-and-reducing-costs-by-90" node="[object Object]" style="color:inherit" target="_blank">blog post</a>
, detailing how they had managed to reduce the cost of their audio-video monitoring service by 90%.
The <em>key</em> to this reduction was migrating from a distributed, microservice architecture to a <em>monolith</em>.
The blog post went viral, prompting some software industry celebrities to
<a href="https://world.hey.com/dhh/even-amazon-can-t-make-sense-of-serverless-or-microservices-59625580" node="[object Object]" style="color:inherit" target="_blank">question</a> the entire concept of microservices.</p>
<h3 class="Text-module__text-default Text-module__u-font-h3">What should we learn from this?</h3>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">So, does this mean microservices are fundamentally flawed? Should we all migrate back to monoliths?
<em>No</em> and <em>definitely no</em> I would say. Instead, my takeaways from this article are:</p>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><strong>Microservices aren&#x27;t about scaling for performance.</strong> At least not primarily. Although horizontally scalability for computationally intensive operations <em>can</em> be very useful or even essential in some cases, it tends to be a rare benefit. Very often, performance bottlenecks are IO bound and caused by external systems beyond your control. Nevertheless, there <em>are</em> other compelling reasons to consider microservices: they <em>force</em> you to communicate via contracts, <em>encourage</em> you to organize your functionality around domains, and <em>allow</em> you to scale your organization. Of course, all this comes at considerable costs. There&#x27;s no <a href="#presentation" node="[object Object]" style="color:inherit">free lunch üëá</a>.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<iframe width="372" height="208" src="https://www.youtube.com/embed/RC_FHNRI8Lg" title="YouTube video player" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" style="float:right;padding:5px"></iframe> <b>Don&#x27;t underestimate the power of a single CPU in 2023</b>. To judge whether a process is unreasonably slow or not, I tend to think of the fact that already in the 1990s, screens showed 65K pixels at any given time. Back then, multiple arithmetic calculations (additions, subtractions) could be performed for each pixel, fifty times per second. Nowadays, your screen probably displays more than 5 Million pixels at once. So, if the amount of datapoints you are dealing with in the order of millions, you should generally be able to process them in a matter of seconds on a single machine. If you can&#x27;t, you may be doing something <i>very</i> inefficient.
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><strong>Software engineering is hard</strong>. Mistakes are made all the time, everywhere. Even at the big 4 tech companies. Kudos to Amazon üëè for openly sharing the mistake they made so that we may all learn.</li>
</ol>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">In the next section I will share one of our own experiences, not entirely different from the Amazon example.</p>
<h3 class="Text-module__text-default Text-module__u-font-h3">The 90% cost reduction case at Vandebron</h3>
<h4 class="Text-module__text-default Text-module__u-font-h4">Microservices or just distributed computing?</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Considering that all the functionality used in the Amazon case belongs to the same <em>domain</em>, it arguably does not even serve as
a case against improper use of microservices, but instead a case against misuse <em>distributed computing</em>. <br/>
Let&#x27;s look into an example of misuse of distributed computing at Vandebron now.</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">Predicting the production of electricity</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">For utility companies, accurately predicting both electricity consumption and production is crucial.
Failing to do so can result in blackouts or overproduction, both of which are <a href="https://vandebron.nl/blog/hoe-houdt-onze-technologie-het-energienet-in-balans" node="[object Object]" style="color:inherit" target="_blank">very costly</a>.
Vandebron is a unique utility company in that the electricity that our customers consume is produced by a <a href="https://vandebron.nl/energiebronnen" node="[object Object]" style="color:inherit" target="_blank">very large
amount</a> of relatively small scale producers, who produce electricity using windmills or solar panels.
The large number and the weather dependent nature of these producers make it very hard to predict electricity generation accurately.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">To do this, we use a machine learning model that is trained on historical production data
and predictions from the national weather <a href="https://www.knmi.nl/" node="[object Object]" style="color:inherit" target="_blank">institute</a>. As you can imagine, this is a computationally intensive task, involving large amounts of data.
Fortunately, we have <a href="https://www.vandebron.tech/blog/fueling-the-energy-transition-with-spark-part-1" node="[object Object]" style="color:inherit" target="_blank">tooling in place</a> that
allows us to distribute computations of a cluster of machines if the task is too large for a single machine to handle.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">However, here&#x27;s the catch: the fact that we <em>can</em> distribute computations does not mean that we should. Initially it seemed that
we couldn&#x27;t analyze the weather data quick enough for the estimation of our production to still be a <em>prediction</em>
rather than a <em>postdiction</em>. We decided to distribute the computation of the weather data over a cluster of machines.
This worked, but it made our software more complex and Jeff Bezos even richer than he already was.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Upon closer inspection, we found an extreme inefficiency in our code. It turned out that we were repeatedly reading the entire weather dataset
into memory, for <em>every</em> single &quot;pixel&quot;. After removing this performance bug, the entire analysis could <em>easily</em> be done
on a single machine.</p>
<h3 class="Text-module__text-default Text-module__u-font-h3">What more is there to say? <a id="presentation" href="" node="[object Object]" style="color:inherit" target="_blank"> </a></h3>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">So if microservices aren&#x27;t about performance, what <em>are</em> they about? If I had to sum it up in one sentence It would be:</p>
<blockquote>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]"><em>Microservices are a way to scale your organization</em></p>
</blockquote>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">There is a lot of detail hiding in that sentence, which I can&#x27;t unpack in the scope of this article. If you&#x27;re interested
what microservices have meant for us, I would recommend you watch the presentation below.</p>
<h4 class="Text-module__text-default Text-module__u-font-h4">Microservices at Vandebron</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">At <a href="https://vandebron.nl/" node="[object Object]" style="color:inherit" target="_blank">Vandebron</a>, we jumped onto the &quot;microservice bandwagon&quot; circa 2019. This wasn&#x27;t a decision
made on a whim. We had seen a few industry trends come and go, so we first <a href="https://samnewman.io/books/building_microservices_2nd_edition/" node="[object Object]" style="color:inherit" target="_blank">read up</a>
and did our own analysis. We found that the concept of microservices held promise, but also knew that they would come at a cost.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">These are some of the dangers we identified and what we did to mitigate them.</p>

























<table style="border-collapse:collapse;margin-bottom:5%;margin-left:5%;margin-right:5%;font-size:18px" align="center" class="Table-module__Table Table-module__solid-borders"><thead style="color:black"><tr style="border-bottom:1px solid #000" class="Table-module__Row"><td class="Table-module__Cell"><strong>Danger</strong></td><td class="Table-module__Cell"><strong>Mitigation</strong></td></tr></thead><tbody><tr style="border-bottom:1px solid #000" class="Table-module__Row"><td class="Table-module__Cell"><em>A stagnating architecture</em></td><td class="Table-module__Cell">Compile and unit-test time detection of breaking changes</td></tr><tr style="border-bottom:1px solid #000" class="Table-module__Row"><td class="Table-module__Cell"><em>Complicated and error prone deployments</em></td><td class="Table-module__Cell">Modular CI/CD <a href="https://github.com/Vandebron/mpyl" node="[object Object]" style="color:inherit" target="_blank">pipelines</a></td></tr><tr style="border-bottom:1px solid #000" class="Table-module__Row"><td class="Table-module__Cell"><em>Team siloization</em></td><td class="Table-module__Cell">A single repository (AKA monorepo) for all microservices and a discussion platform for cross-domain and cross-team concerns</td></tr><tr style="border-bottom:1px solid #000" class="Table-module__Row"><td class="Table-module__Cell"><em>Duplication of code</em></td><td class="Table-module__Cell">Shared in house libraries for common functionality</td></tr></tbody></table>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">The following presentation to the students of <a href="https://vu.nl/" node="[object Object]" style="color:inherit" target="_blank">VU University, Amsterdam</a> explains how we implemented
some of these mitigations and what we learned from them.</p>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]"><a href="https://youtu.be/HDs-pCsEzKM" node="[object Object]" style="color:inherit" target="_blank"><img src="/images/play_presentation.webp" alt="Presentation about micro services to students of VU Amsterdam" style="width:100%" node="[object Object]"/></a></p></div></div></div><footer style="padding-top:30px;padding-bottom:30px;background-color:#363639"><div class="Container-module__container"><div class="Row-module__row Row-module__align-items-center" style="margin-bottom:15px"><div class="Col-module__col-box-sizing Col-module__col"><div><div style="cursor:pointer;user-select:none;display:flex;align-items:baseline"><svg width="140" viewBox="0 0 140 22" xmlns="http://www.w3.org/2000/svg"><path d="M9.569 21.109h-4.25L0 6.274h4.597l2.86 9.249 2.86-9.249h4.598L9.57 21.11m13.234-4.258a3.159 3.159 0 0 1 0-6.316 3.156 3.156 0 0 1 3.144 2.884v.543a3.157 3.157 0 0 1-3.144 2.889m3.2-9.81a7.38 7.38 0 1 0 0 13.3c.136.425.537.73 1.003.73h3.174V6.313h-3.174c-.466 0-.867.304-1.003.728m64.522 3.567a3.155 3.155 0 0 0-3.141 2.888v.542a3.155 3.155 0 0 0 3.14 2.885 3.16 3.16 0 0 0 3.165-3.157 3.163 3.163 0 0 0-3.164-3.158m0 10.536a7.337 7.337 0 0 1-3.195-.727 1.056 1.056 0 0 1-1.006.727h-3.171V0h4.23v7.09a7.377 7.377 0 0 1 10.522 6.676c.001 4.074-3.298 7.378-7.38 7.378m26.406-4.22a3.155 3.155 0 0 1-3.141-2.886v-.542a3.155 3.155 0 0 1 3.141-2.888 3.163 3.163 0 0 1 3.164 3.159 3.161 3.161 0 0 1-3.164 3.156m.012-10.511c-5.054 0-7.481 3.978-7.481 7.356v.025c0 3.402 2.427 7.38 7.48 7.38 5.054 0 7.48-3.978 7.48-7.38 0-3.403-2.426-7.381-7.48-7.381m-60.448 4.196a3.155 3.155 0 0 1 3.141 2.888v.542a3.156 3.156 0 0 1-3.141 2.885 3.16 3.16 0 0 1-3.165-3.157 3.163 3.163 0 0 1 3.165-3.158m0 10.536a7.377 7.377 0 0 1-7.381-7.378A7.377 7.377 0 0 1 59.635 7.09V0h4.23v21.144h-3.17c-.473 0-.866-.303-1.006-.727a7.342 7.342 0 0 1-3.195.727zm51.349-14.856v4.222a3.074 3.074 0 0 0-.244-.013c-1.64 0-3.138 1.057-3.138 2.585v8.025h-4.234V6.276h3.17c.473 0 .867.303 1.006.727a7.353 7.353 0 0 1 3.196-.727c.082 0 .162.01.244.012zm25.525 4.21c-1.467 0-2.348.886-2.348 2.584v8.09h-4.285V6.277h3.172c.472 0 .865.304 1.005.727a7.347 7.347 0 0 1 3.195-.727s1.239-.059 2.514.343c3.027.904 3.379 3.962 3.379 5.599v8.955h-4.284v-8.091c0-.883-.205-2.585-2.348-2.585zm-93.333 0c-1.467 0-2.348.886-2.348 2.584v8.09h-4.284V6.277h3.17c.474 0 .866.304 1.006.727a7.354 7.354 0 0 1 3.196-.727s1.239-.059 2.514.343c3.028.904 3.378 3.962 3.378 5.599v8.955h-4.284v-8.091c0-.883-.204-2.585-2.348-2.585zm36.24 1.755h-5.453c-.116-.003-.55-.055-.325-.637a3.336 3.336 0 0 1 6.134.093c.147.495-.246.541-.356.544m2.55-3.796c-1.308-1.384-3.145-2.214-5.284-2.214-4.254 0-7.324 3.598-7.324 7.5 0 4.15 3.398 7.398 7.399 7.398a6.789 6.789 0 0 0 3.976-1.258c1.183-.806 2.165-2.013 2.844-3.574h-4.278c-.503.73-1.208 1.31-2.542 1.31-1.635 0-3.045-.983-3.22-2.468h10.393c.327-2.566-.202-4.806-1.964-6.694" fill="#ffffff" fill-rule="evenodd"></path></svg>¬†<span class="Text-module__text-default Text-module__u-font-h3 Text-module__u-font-color-green" style="font-size:28px;margin:0;line-height:auto">.tech</span></div></div></div></div><div class="Row-module__row Row-module__align-items-center"><div class="Col-module__col-box-sizing Col-module__col"><span class="Text-module__text-default" style="color:white">¬© Vandebron</span></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\n\n### Amazon embraces the mighty monolith\n\n\u003cimg src=\"/images/step-functions.webp\" alt=\"image alt text\" style=\"width: 50%; float: left; padding: 5px;\" /\u003e\n\nIn March 2023, Amazon published a [blog post](https://www.primevideotech.com/video-streaming/scaling-up-the-prime-video-audio-video-monitoring-service-and-reducing-costs-by-90)\n, detailing how they had managed to reduce the cost of their audio-video monitoring service by 90%.\nThe _key_ to this reduction was migrating from a distributed, microservice architecture to a _monolith_.\nThe blog post went viral, prompting some software industry celebrities to \n[question](https://world.hey.com/dhh/even-amazon-can-t-make-sense-of-serverless-or-microservices-59625580) the entire concept of microservices.\n\n### What should we learn from this?\n\nSo, does this mean microservices are fundamentally flawed? Should we all migrate back to monoliths?\n_No_ and _definitely no_ I would say. Instead, my takeaways from this article are:\n\n1.  **Microservices aren't about scaling for performance.** At least not primarily. Although horizontally scalability for computationally intensive operations _can_ be very useful or even essential in some cases, it tends to be a rare benefit. Very often, performance bottlenecks are IO bound and caused by external systems beyond your control. Nevertheless, there _are_ other compelling reasons to consider microservices: they _force_ you to communicate via contracts, _encourage_ you to organize your functionality around domains, and _allow_ you to scale your organization. Of course, all this comes at considerable costs. There's no [free lunch üëá](#presentation).\n2.  \u003ciframe width=\"372\" height=\"208\" src=\"https://www.youtube.com/embed/RC_FHNRI8Lg\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen style=\"float: right; padding: 5px;\"\u003e\u003c/iframe\u003e \u003cb\u003eDon't underestimate the power of a single CPU in 2023\u003c/b\u003e. To judge whether a process is unreasonably slow or not, I tend to think of the fact that already in the 1990s, screens showed 65K pixels at any given time. Back then, multiple arithmetic calculations (additions, subtractions) could be performed for each pixel, fifty times per second. Nowadays, your screen probably displays more than 5 Million pixels at once. So, if the amount of datapoints you are dealing with in the order of millions, you should generally be able to process them in a matter of seconds on a single machine. If you can't, you may be doing something \u003ci\u003every\u003c/i\u003e inefficient.\n3.  **Software engineering is hard**. Mistakes are made all the time, everywhere. Even at the big 4 tech companies. Kudos to Amazon üëè for openly sharing the mistake they made so that we may all learn.\nIn the next section I will share one of our own experiences, not entirely different from the Amazon example.\n\n### The 90% cost reduction case at Vandebron\n\n#### Microservices or just distributed computing?\nConsidering that all the functionality used in the Amazon case belongs to the same _domain_, it arguably does not even serve as \na case against improper use of microservices, but instead a case against misuse *distributed computing*. \u003cbr/\u003e\nLet's look into an example of misuse of distributed computing at Vandebron now.\n\n#### Predicting the production of electricity\nFor utility companies, accurately predicting both electricity consumption and production is crucial.\nFailing to do so can result in blackouts or overproduction, both of which are [very costly](https://vandebron.nl/blog/hoe-houdt-onze-technologie-het-energienet-in-balans).\nVandebron is a unique utility company in that the electricity that our customers consume is produced by a [very large\namount](https://vandebron.nl/energiebronnen) of relatively small scale producers, who produce electricity using windmills or solar panels.\nThe large number and the weather dependent nature of these producers make it very hard to predict electricity generation accurately.\n\nTo do this, we use a machine learning model that is trained on historical production data \nand predictions from the national weather [institute](https://www.knmi.nl/). As you can imagine, this is a computationally intensive task, involving large amounts of data.\nFortunately, we have [tooling in place](https://www.vandebron.tech/blog/fueling-the-energy-transition-with-spark-part-1) that\nallows us to distribute computations of a cluster of machines if the task is too large for a single machine to handle.\n\nHowever, here's the catch: the fact that we _can_ distribute computations does not mean that we should. Initially it seemed that\nwe couldn't analyze the weather data quick enough for the estimation of our production to still be a _prediction_\nrather than a _postdiction_. We decided to distribute the computation of the weather data over a cluster of machines.\nThis worked, but it made our software more complex and Jeff Bezos even richer than he already was.\n\nUpon closer inspection, we found an extreme inefficiency in our code. It turned out that we were repeatedly reading the entire weather dataset\ninto memory, for _every_ single \"pixel\". After removing this performance bug, the entire analysis could _easily_ be done\non a single machine. \n\n### What more is there to say? \u003ca id=\"presentation\"\u003e \u003c/a\u003e\n\n\nSo if microservices aren't about performance, what _are_ they about? If I had to sum it up in one sentence It would be:\n\u003e _Microservices are a way to scale your organization_\n\nThere is a lot of detail hiding in that sentence, which I can't unpack in the scope of this article. If you're interested\nwhat microservices have meant for us, I would recommend you watch the presentation below.\n\n\n#### Microservices at Vandebron\nAt [Vandebron](https://vandebron.nl/), we jumped onto the \"microservice bandwagon\" circa 2019. This wasn't a decision\nmade on a whim. We had seen a few industry trends come and go, so we first [read up](https://samnewman.io/books/building_microservices_2nd_edition/)\nand did our own analysis. We found that the concept of microservices held promise, but also knew that they would come at a cost.\n\nThese are some of the dangers we identified and what we did to mitigate them.\n\n| **Danger**                                | **Mitigation**                                                                                                              |\n|-------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|\n| _A stagnating architecture_               | Compile and unit-test time detection of breaking changes                                                                    |\n| _Complicated and error prone deployments_ | Modular CI/CD [pipelines](https://github.com/Vandebron/mpyl)                                                                |\n| _Team siloization_                        | A single repository (AKA monorepo) for all microservices and a discussion platform for cross-domain and cross-team concerns |\n| _Duplication of code_                     | Shared in house libraries for common functionality                                                                          |\n\n\n\nThe following presentation to the students of [VU University, Amsterdam](https://vu.nl/) explains how we implemented\nsome of these mitigations and what we learned from them.\n\n[![Presentation about micro services to students of VU Amsterdam](/images/play_presentation.webp)](https://youtu.be/HDs-pCsEzKM)\n","meta":{"title":"So, back to the monolith it is then?","description":"A recent Amazon article explaining how they managed to save costs by merging some of their services has lead some to question the value of microservices. What is our take?","createdAt":"Sat May 20 2023 00:00:00 GMT+0000 (Coordinated Universal Time)","coverImage":"images/monolith.webp","tags":"dagster, cicd, ci-cd, orchestration, data pipeline, kubernetes, migration, helm, ansible","author":"Sam Theisens","slug":"blog/back-to-the-monolith","formattedDate":"20 mei 2023","date":"Sat May 20 2023 00:00:00 GMT+0000 (Coordinated Universal Time)"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"back-to-the-monolith"},"buildId":"sQnSftIyu2K0pCbUqWUSA","assetPrefix":"/pr-preview/pr-33","isFallback":false,"gsp":true}</script><script nomodule="" src="/pr-preview/pr-33/_next/static/chunks/polyfills-28654a8145d7603786fc.js"></script><script src="/pr-preview/pr-33/_next/static/chunks/webpack-0b9cc56c94819e8023ea.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/framework.87b9127d6cd191ae1c9a.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.e3444f50a0a795e3eeb2.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/main-419ac17f185f95278b96.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/7b9503d2.4af90216c47085b5c8e9.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/0357a89c.a83a6a4548b93404854d.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/226daff62b2d4bc1e9a7210a7f6000a544319a74.fbdd4d016a5c47ddc9db.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/pages/_app-fdd34d89c08fa14a1e57.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/1c49f5f00355f650bee3d37484f094be037a30fa.0c099ecf2acefc71ba39.js" async=""></script><script src="/pr-preview/pr-33/_next/static/chunks/pages/blog/%5Bslug%5D-b9610da0b3e709e6b9cf.js" async=""></script><script src="/pr-preview/pr-33/_next/static/sQnSftIyu2K0pCbUqWUSA/_buildManifest.js" async=""></script><script src="/pr-preview/pr-33/_next/static/sQnSftIyu2K0pCbUqWUSA/_ssgManifest.js" async=""></script></body></html>