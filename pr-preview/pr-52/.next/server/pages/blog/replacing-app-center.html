<!DOCTYPE html><html lang="en"><head><script async="" src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="https://d381m57et8llfk.cloudfront.net/20210128-6054/static/css/dc7f55cf12b36887a247.fonts.css"/><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
                ga('create', 'UA-49472651-19', { 'storage': 'none' });
                ga('send', 'pageview');</script><script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js" crossorigin="anonymous"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Finding a Replacement for App Center</title><meta name="Description" content="App Center is closing up shop on March 31st, 2025 so what&#x27;s the plan for building mobile apps at Vandebron?"/><meta property="og:title" content="Finding a Replacement for App Center"/><meta property="og:description" content="App Center is closing up shop on March 31st, 2025 so what&#x27;s the plan for building mobile apps at Vandebron?"/><meta property="og:image" content="https://www.vandebron.tech/images/replacing-app-center-building-a-phone.jpg"/><meta name="next-head-count" content="7"/><link rel="preload" href="/pr-preview/pr-52/_next/static/css/a71c8cb20b7a0418d3c9.css" as="style"/><link rel="stylesheet" href="/pr-preview/pr-52/_next/static/css/a71c8cb20b7a0418d3c9.css" data-n-g=""/><link rel="preload" href="/pr-preview/pr-52/_next/static/css/7315cd22ce6d345bbcda.css" as="style"/><link rel="stylesheet" href="/pr-preview/pr-52/_next/static/css/7315cd22ce6d345bbcda.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/webpack-0b9cc56c94819e8023ea.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/framework.87b9127d6cd191ae1c9a.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.e863e97795daa2195b5e.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/main-419ac17f185f95278b96.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/7b9503d2.4af90216c47085b5c8e9.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/645636b0.a83a6a4548b93404854d.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/226daff62b2d4bc1e9a7210a7f6000a544319a74.fbdd4d016a5c47ddc9db.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/pages/_app-4af7ffd42c025008877f.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/1c49f5f00355f650bee3d37484f094be037a30fa.c32ba6a52f424c1ca4c3.js" as="script"/><link rel="preload" href="/pr-preview/pr-52/_next/static/chunks/pages/blog/%5Bslug%5D-3fa11fb8931c3ce2a9d9.js" as="script"/></head><body><div id="__next"><div class="Container-module__container" as="header" style="padding-top:30px;padding-bottom:30px;margin-bottom:30px"><div class="Row-module__row Row-module__align-items-center Row-module__justify-content-between"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12 Col-module__col-md-auto Col-module__col-lg-auto Col-module__col-sm-12"><div><div style="cursor:pointer;user-select:none;display:flex;align-items:baseline"><svg width="140" viewBox="0 0 140 22" xmlns="http://www.w3.org/2000/svg"><path d="M9.569 21.109h-4.25L0 6.274h4.597l2.86 9.249 2.86-9.249h4.598L9.57 21.11m13.234-4.258a3.159 3.159 0 0 1 0-6.316 3.156 3.156 0 0 1 3.144 2.884v.543a3.157 3.157 0 0 1-3.144 2.889m3.2-9.81a7.38 7.38 0 1 0 0 13.3c.136.425.537.73 1.003.73h3.174V6.313h-3.174c-.466 0-.867.304-1.003.728m64.522 3.567a3.155 3.155 0 0 0-3.141 2.888v.542a3.155 3.155 0 0 0 3.14 2.885 3.16 3.16 0 0 0 3.165-3.157 3.163 3.163 0 0 0-3.164-3.158m0 10.536a7.337 7.337 0 0 1-3.195-.727 1.056 1.056 0 0 1-1.006.727h-3.171V0h4.23v7.09a7.377 7.377 0 0 1 10.522 6.676c.001 4.074-3.298 7.378-7.38 7.378m26.406-4.22a3.155 3.155 0 0 1-3.141-2.886v-.542a3.155 3.155 0 0 1 3.141-2.888 3.163 3.163 0 0 1 3.164 3.159 3.161 3.161 0 0 1-3.164 3.156m.012-10.511c-5.054 0-7.481 3.978-7.481 7.356v.025c0 3.402 2.427 7.38 7.48 7.38 5.054 0 7.48-3.978 7.48-7.38 0-3.403-2.426-7.381-7.48-7.381m-60.448 4.196a3.155 3.155 0 0 1 3.141 2.888v.542a3.156 3.156 0 0 1-3.141 2.885 3.16 3.16 0 0 1-3.165-3.157 3.163 3.163 0 0 1 3.165-3.158m0 10.536a7.377 7.377 0 0 1-7.381-7.378A7.377 7.377 0 0 1 59.635 7.09V0h4.23v21.144h-3.17c-.473 0-.866-.303-1.006-.727a7.342 7.342 0 0 1-3.195.727zm51.349-14.856v4.222a3.074 3.074 0 0 0-.244-.013c-1.64 0-3.138 1.057-3.138 2.585v8.025h-4.234V6.276h3.17c.473 0 .867.303 1.006.727a7.353 7.353 0 0 1 3.196-.727c.082 0 .162.01.244.012zm25.525 4.21c-1.467 0-2.348.886-2.348 2.584v8.09h-4.285V6.277h3.172c.472 0 .865.304 1.005.727a7.347 7.347 0 0 1 3.195-.727s1.239-.059 2.514.343c3.027.904 3.379 3.962 3.379 5.599v8.955h-4.284v-8.091c0-.883-.205-2.585-2.348-2.585zm-93.333 0c-1.467 0-2.348.886-2.348 2.584v8.09h-4.284V6.277h3.17c.474 0 .866.304 1.006.727a7.354 7.354 0 0 1 3.196-.727s1.239-.059 2.514.343c3.028.904 3.378 3.962 3.378 5.599v8.955h-4.284v-8.091c0-.883-.204-2.585-2.348-2.585zm36.24 1.755h-5.453c-.116-.003-.55-.055-.325-.637a3.336 3.336 0 0 1 6.134.093c.147.495-.246.541-.356.544m2.55-3.796c-1.308-1.384-3.145-2.214-5.284-2.214-4.254 0-7.324 3.598-7.324 7.5 0 4.15 3.398 7.398 7.399 7.398a6.789 6.789 0 0 0 3.976-1.258c1.183-.806 2.165-2.013 2.844-3.574h-4.278c-.503.73-1.208 1.31-2.542 1.31-1.635 0-3.045-.983-3.22-2.468h10.393c.327-2.566-.202-4.806-1.964-6.694" fill="#333D47" fill-rule="evenodd"></path></svg>Â <span class="Text-module__text-default Text-module__u-font-h3 Text-module__u-font-color-green" style="font-size:28px;margin:0;line-height:auto">.tech</span></div></div></div><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12 Col-module__col-md-auto Col-module__col-lg-auto Col-module__col-sm-12"><div class="Flex-module__d-flex Flex-module__flex-row Flex-module__align-items-stretch Flex-module__justify-content-start Flex-module__justify-content-sm-between"><ul class="Navigation-module__navigation-wrapper" id="styled-navigation" style="margin-right:25px"><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link Navigation-module__navigation-link-active" name="Home" url="/"><span>Home</span></a></li><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link" name="About" url="/about"><span>About</span></a></li><li class="Navigation-module__navigation-link-wrapper"><a class="Pressable-module__button Pressable-module__text Navigation-module__navigation-link" name="vandebron.nl" url="https://vandebron.nl"><span>vandebron.nl</span></a></li><div class="Navigation-module__navigation-magic-line" style="transition:none;left:0;width:0"></div></ul><div><a class="Pressable-module__button Pressable-module__text" href="https://github.com/vandebron/" target="_blank" rel="noreferrer" style="margin-right:10px"><svg role="img" viewBox="0 0 24 24" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">Vandebron on Github</span></a><a class="Pressable-module__button Pressable-module__text" href="https://dev.to/vandebron/" target="_blank" rel="noreferrer" style="margin-right:10px"><svg viewBox="0 0 448 512" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"></path></svg><span class="visually-hidden">Vandebron on Dev.to</span></a><a class="Pressable-module__button Pressable-module__text" href="https://medium.com/vandebron/" target="_blank" rel="noreferrer"><svg viewBox="0 0 448 512" width="1em" height="1em" class="Icon-module__icon Icon-module__u-font-color-charcoal-gray" style="font-size:150%"><path fill="currentColor" d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"></path></svg><span class="visually-hidden">Vandebron on Medium</span></a></div></div></div></div></div><div class="Container-module__container"><div class="Row-module__row"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><h2 class="Text-module__text-default Text-module__u-font-h2">Finding a Replacement for App Center</h2></div><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><p class="Text-module__text-default Text-module__u-font-body"><span class="Text-module__text-default">By John Fisher &amp; Arnav Mundkur on 25 januari 2025</span></p></div></div><div class="Row-module__row"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><p class="Text-module__text-default Text-module__u-font-body"><div class="Image-module__image-container" style="padding-bottom:50%"><div style="height:200px" class="lazyload-placeholder"></div></div></p></div></div><div class="Row-module__row" style="margin-bottom:60px"><div class="Col-module__col-box-sizing Col-module__col Col-module__col-12"><h2 class="Text-module__text-default Text-module__u-font-h2">Why GHA?</h2>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">This seems like a lot of work... Why not go with an off-the-shelf solution from something like Bitrise or Codemagic? Fair question but not the main point of this post. To look into our reasoning check out the <a href="#benefits" node="[object Object]" style="color:inherit">Benefits</a> section!</p>
<h2 class="Text-module__text-default Text-module__u-font-h2">Some notes before we get started</h2>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">We use this workflow to build two apps, one of which can be white-labeled, so we have additional <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">app</code> and <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">white-label-release</code> inputs which makes things a bit trickier. You might not need that so feel free to trim stuff down and make it your own! But for us, we why we have the <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">env-variable-prep-android.sh</code> which normalizes the variable names used for secrets so those secrets and build file names, etc. can be easily used. If you just have a single app you probably don&#x27;t need this script.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">The code below is only for the build process. Though the ADR considered how this would affect future decisions about artifact upload automation and rolling out releases for internal testing, nothing about that is automated here.</li>
</ol>
<h2 class="Text-module__text-default Text-module__u-font-h2">Implementation</h2>
<h4 class="Text-module__text-default Text-module__u-font-h4">Part 1 - Basic Setup</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Add the files below. Nothing in this setup should effect App Center but it is good to check in your changes to a branch and test those against the regular App Center build flow.</p>
  <table style="border-collapse:collapse;margin-bottom:5%;font-size:18px;border:none" align="center" class="Table-module__Table Table-module__solid-borders">
    <thead style="color:black;position:sticky;top:0">
      <tr style="background-color:rgba(255, 255, 255, 0.5)" class="Table-module__Row">
        <td class="Table-module__Cell">Android</td>
        <td class="Table-module__Cell">iOS</td>
      </tr>
    </thead>
    <tbody style="vertical-align:top">
      <tr class="Table-module__Row">
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-yaml" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: .github/workflows/mobile-apps-build-android.yaml
  ---
  name: Mobile App Build for Android
  run-name: &quot;Build: Android, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}&quot;
  on:
    workflow_dispatch:
      inputs:
        app:
          description: &#x27;App&#x27;
          required: true
          type: choice
          options:
            - my-first-app
            - my-second-app
        environment:
          description: &#x27;Environment&#x27;
          required: true
          type: choice
          options:
            - test
            - acceptance
            - production
        white-label-release:
          description: &#x27;White-labeled Release?&#x27;
          type: boolean
          default: false
  jobs:
    build:
      name: Build app for android
      runs-on: ubuntu-latest
      environment: ${{ inputs.environment }}
      steps:
        - name: Checkout ${{ github.repository }}
          uses: actions/checkout@v4.2.2
        - name: Echo Input
          env:
            APP: ${{ inputs.app }}
            WHITE_LABEL_RELEASE: ${{ inputs.white-label-release }}
            ENVIRONMENT: ${{ inputs.environment }}
          run: |
            echo &quot;APP=$APP&quot;
            echo &quot;WHITE_LABEL_RELEASE=$WHITE_LABEL_RELEASE&quot;
            echo &quot;ENVIRONMENT=$ENVIRONMENT&quot;
            </code></div>
          </pre>
        </td>
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: .github/workflows/mobile-apps-build-ios.yaml
  ---
  name: Mobile App Build for iOS
  run-name: &quot;Build: iOS, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}&quot;
  on:
    workflow_dispatch:
      inputs:
        app:
          description: &#x27;App&#x27;
          required: true
          type: choice
          options:
            - my-first-app
            - my-second-app
        environment:
          description: &#x27;Environment&#x27;
          required: true
          type: choice
          options:
            - test
            - acceptance
            - production
        white-label-release:
          description: &#x27;White-labeled Release?&#x27;
          type: boolean
          default: false
  jobs:
    build:
      name: Build app for iOS
      runs-on: macos-latest
      environment: ${{ inputs.environment }}
      steps:
        - name: Checkout ${{ github.repository }}
          uses: actions/checkout@v4.2.2
        - name: Echo Input
          env:
            APP: ${{ inputs.app }}
            WHITE_LABEL_RELEASE: ${{ inputs.white-label-release }}
            ENVIRONMENT: ${{ inputs.environment }}
          run: |
            echo &quot;APP=$APP&quot;
            echo &quot;WHITE_LABEL_RELEASE=$WHITE_LABEL_RELEASE&quot;
            echo &quot;ENVIRONMENT=$ENVIRONMENT&quot;
            </code></div>
          </pre>
        </td>
      </tr>
      <tr class="Table-module__Row">
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: env-variable-prep-android.sh
  #!/bin/bash
  ARTIFACT_NAME=&quot;mobile-my-first-app-${ENVIRONMENT}-release&quot;
  FASTLANE_ANDROID_FLAVOR=&quot;${ENVIRONMENT}&quot;
  {
    echo &quot;artifact-name=${ARTIFACT_NAME}&quot;
    echo &quot;fastlane-android-flavor=${FASTLANE_ANDROID_FLAVOR}&quot;
  } | tee -a &quot;$GITHUB_OUTPUT&quot;
  # Secrets should not get sent out over tee command (which also prints it to console)
  {
    echo &quot;android-key-alias=my-first-app&quot;
    echo &quot;android-keystore-file=../keystores/my-first-app.jks&quot;
    echo &quot;android-keystore-pass=${ANDROID_KEY_PASSWORD}&quot;
    echo &quot;android-store-pass=${ANDROID_STORE_PASSWORD}&quot;
  } &gt;&gt; &quot;$GITHUB_OUTPUT&quot;
            </code></div>
          </pre>
        </td>
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: env-variable-prep-ios.sh
  #!/bin/bash
  # Secrets should not get sent out over tee command (which also prints it to console)
  {
    echo &quot;ios-mobile-provisioning-profile=${IOS_MOBILE_PROVISIONING_PROFILE}&quot;
  } &gt;&gt; &quot;$GITHUB_OUTPUT&quot;
            </code></div>
          </pre>
        </td>
      </tr>
      <tr class="Table-module__Row">
        <td colSpan="100%;" node="[object Object]" style="width:100%" class="Table-module__Cell expanded-table-cell">
          <pre style="font-size:0.8rem;display:flex">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: env-file-prep.sh
  #!/usr/bin/env bash
  #####################################################
  # Creates an .env file for use in react-native-config
  # This script should be run from the /mobile folder
  #####################################################
  if [ &quot;${ENVIRONMENT}&quot; != &quot;test&quot; ] &amp;&amp; [ &quot;${ENVIRONMENT}&quot; != &quot;acceptance&quot; ] &amp;&amp; [ &quot;${ENVIRONMENT}&quot; != &quot;production&quot; ]; then
      echo &quot;ENVIRONMENT is not set, using &#x27;production&#x27; as default.&quot;
      ENVIRONMENT=production
  fi
  echo &quot;Copying &#x27;my-first-app/.env.${ENVIRONMENT}&#x27; to &#x27;my-first-app/.env&#x27;...&quot;
  cp &quot;my-first-app/.env.${ENVIRONMENT}&quot; &quot;my-first-app/.env&quot;
  echo &quot;Success!&quot;
            </code></div>
          </pre>
        </td>
      </tr>
      <tr class="Table-module__Row">
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: ./fastlane/Fastfile
  opt_out_usage
  platform :android do
    desc &#x27;Build app for Android&#x27;
      lane :build do
        build_android_app(
          task: &#x27;bundle&#x27;,
          flavor: ENV[&#x27;FASTLANE_ANDROID_FLAVOR&#x27;],
          build_type: &#x27;Release&#x27;,
          project_dir: &#x27;android/&#x27;,
          print_command: true,
          print_command_output: true,
        )
      end
  end
            </code></div>
          </pre>
        </td>
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="display:flex;justify-content:center">  N/A for iOS
          </pre>
        </td>
      </tr>
      <tr class="Table-module__Row">
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="display:flex;justify-content:center">  N/A for Android
          </pre>
        </td>
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: ./fastlane/Gymfile
  scheme(ENV[&#x27;SCHEME&#x27;])
  workspace(&quot;ios/my-first-app.xcworkspace&quot;)
  export_options(&quot;ios/exportOptions.plist&quot;)
  output_directory(&quot;ios/build&quot;)
  output_name(ENV[&#x27;SCHEME&#x27;])
            </code></div>
          </pre>
        </td>
      </tr>
    </tbody>
  </table>
<h4 class="Text-module__text-default Text-module__u-font-h4">Part 2 - Testing your Workflow Locally</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">WARNING: GitHub Actions doesn&#x27;t let you run a <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">workflow_dispatch</code> action until it has been merged into the main branch so you&#x27;ll want to get the basic setup above in place before you start tinkering with application logic or things that could effect App Center. Also note that while <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">act</code> is helpful for getting the basics in place, it&#x27;s unlikely you&#x27;ll be able to test the complete process locally because, at least for us a) Android pipeline crashes halfway through the <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">Build App</code> step with an error of <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">Gradle build daemon disappeared unexpectedly (it may have been killed or may have crashed)</code>, and b) iOS tries to install a fresh copy of Xcode</p>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Follow installation instructions on <a href="https://nektosact.com/installation/index.html" node="[object Object]" style="color:inherit" target="_blank">their User Guide</a></p>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Create a <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">~/.actrc</code> file that looks like this</p>
 <pre style="font-size:0.8rem;display:flex">   <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
   --container-architecture linux/amd64
   --secret GITHUB_TOKEN=$GITHUB_TOKEN
   </code></div>
 </pre>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Get your <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">$GITHUB_TOKEN</code> env variable in place</p>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Install <a href="https://cli.github.com/" node="[object Object]" style="color:inherit" target="_blank">gh, the GitHub cli</a></p>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Modify shells (zsh shown below)</p>
 <pre style="font-size:0.8rem;display:flex">   <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
   export GITHUB_TOKEN=&quot;$(gh auth token)&quot;
   </code></div>
 </pre>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Close and re-open your terminal. Test to make sure you can see your <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">GITHUB_TOKEN</code> envrionment variable</p>
</li>
</ol>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Set up a temporary local file for secrets. WARNING: Once youâre done, remember to delete the file so itâs not hanging around on your system!! (or just donât create it in the first place unless you really need it)</p>
 <pre style="font-size:0.8rem;display:flex">   <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
 # file: .secrets
 ANDROID_STORE_PASSWORD=&quot;someSecr3ts&quot;
 ANDROID_KEY_PASSWORD=&quot;YouWantQuotesBecause*s_etc.WillScrewYouUp&quot;
 MAPBOX_READ_TOKEN=shhhhh.Its.asecret
   </code></div>
 </pre>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Set up a temporary local file for your workflow trigger inputs.</p>
 <pre style="font-size:0.8rem;display:flex">   <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-json" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
 /* file: app-input.json */
 {
   &quot;action&quot;: &quot;workflow_dispatch&quot;,
   &quot;inputs&quot;: {
     &quot;app&quot;: &quot;my-first-app&quot;,
     &quot;environment&quot;: &quot;test&quot;,
     &quot;white-label-release&quot;: false
   }
 }
   </code></div>
 </pre>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Run your workflow like this. As far as I know, you can only run the iOS workflow locally if you&#x27;re on a mac. To do that you&#x27;ll need to provide an additional parameter: <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">-P macos-latest=-self-hosted</code></p>
</li>
</ol>
  <table style="border-collapse:collapse;margin-bottom:5%;font-size:18px;border:none" align="center" class="Table-module__Table Table-module__solid-borders">
    <thead style="color:black;position:sticky;top:0">
      <tr style="background-color:rgba(255, 255, 255, 0.5)" class="Table-module__Row">
        <td class="Table-module__Cell">Android</td>
        <td class="Table-module__Cell">iOS</td>
      </tr>
    </thead>
    <tbody style="vertical-align:top">
      <tr class="Table-module__Row">
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
        act \
        --workflows .github/workflows/mobile-apps-build-android.yaml \
        --eventpath=&quot;${HOME}/Documents/IT/GitHub Actions/Mobile Apps/app-input.json&quot; \
        --secret-file=&quot;${HOME}/Documents/IT/GitHub Actions/Mobile Apps/.secrets&quot;
            </code></div>
          </pre>
        </td>
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
        act -P macos-latest=-self-hosted \
        --workflows .github/workflows/mobile-apps-build-ios.yaml \
        --eventpath=&quot;${HOME}/Documents/IT/GitHub Actions/Mobile Apps/app-input.json&quot; \
        --secret-file=&quot;${HOME}/Documents/IT/GitHub Actions/Mobile Apps/.secrets&quot;
            </code></div>
          </pre>
        </td>
      </tr>
    </tbody>
  </table>
<h4 class="Text-module__text-default Text-module__u-font-h4">Part 3 - Testing Things out from GHA</h4>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Once you&#x27;re happy with your changes locally, send a PR &amp; merge them in! Remember this is only the basic setup to get the action avaible from the GitHub Actions interface so maybe leave a comment in the PR notifying your teammates about how they should expect a follow-up PR</p>
</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Go to the &quot;Actions&quot; tab at the top of your GitHub repo. You should now see your actions for building iOS and Android on the left. Since it&#x27;s a <code style="background:rgb(0,0,0, 0.1);padding:2px 4px;font-size:80%;color:#000">workflow_dispatch</code> action you&#x27;ll trigger the actions manually.</p>
 <div>
   <img src="../images/replacing-app-center-run-workflow.png" alt="run-workflow" style="width:500px" node="[object Object]"/>
 </div>
</li>
</ol>
<h4 class="Text-module__text-default Text-module__u-font-h4">Part 4 - Implement the Full Workflow for iOS and Android</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">Adjust the files below. This is where you may end up needing to modify things that affect your App Center build. Try to keep them to a mimimum so you can still use App Center for builds should anything here not work as expected.</p>
  <table style="border-collapse:collapse;margin-bottom:5%;font-size:18px;border:none" align="center" class="Table-module__Table Table-module__solid-borders">
    <thead style="color:black;position:sticky;top:0">
      <tr style="background-color:rgba(255, 255, 255, 0.5)" class="Table-module__Row">
        <td class="Table-module__Cell">Android</td>
        <td class="Table-module__Cell">iOS</td>
      </tr>
    </thead>
    <tbody style="vertical-align:top">
      <tr class="Table-module__Row">
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-yaml" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: .github/workflows/mobile-apps-build-android.yaml
  ---
  name: Mobile App Build for Android
  run-name: &quot;Build: android, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}&quot;
  on:
    workflow_dispatch:
      inputs:
        app:
          description: &#x27;App&#x27;
          required: true
          type: choice
          options:
            - my-first-app
            - my-second-app
        environment:
          description: &#x27;Environment&#x27;
          required: true
          type: choice
          options:
            - test
            - acceptance
            - production
        white-label-release:
          description: &#x27;White-labeled Release?&#x27;
          type: boolean
          default: false
  jobs:
    build:
      name: Build app for android
      runs-on: ubuntu-latest
      environment: ${{ inputs.environment }}
      steps:
        - name: Checkout ${{ github.repository }}
          uses: actions/checkout@v4.2.2
        - name: Prep Env Variables
          id: prep-env-variables
          working-directory: mobile
          env:
            APP: ${{ inputs.app }} # my-first-app | my-second-app
            ENVIRONMENT: ${{ inputs.environment }}  # production | test | acceptance
            BRAND: ${{ inputs.white-label-release &amp;&amp; &#x27;other-company&#x27; || &#x27;my-company&#x27; }}
            APP_1_ANDROID_KEY_PASSWORD_VANDEBRON: ${{ secrets.APP_1_ANDROID_KEY_PASSWORD_VANDEBRON }}
            APP_1_ANDROID_STORE_PASSWORD_VANDEBRON: ${{ secrets.APP_1_ANDROID_STORE_PASSWORD_VANDEBRON }}
            APP_1_ANDROID_KEY_PASSWORD_WHITE_LABEL: ${{ secrets.APP_1_ANDROID_KEY_PASSWORD_WHITE_LABEL }}
            APP_1_ANDROID_STORE_PASSWORD_WHITE_LABEL: ${{ secrets.APP_1_ANDROID_STORE_PASSWORD_WHITE_LABEL }}
            APP_2_ANDROID_KEY_PASSWORD_VANDEBRON: ${{ secrets.APP_2_ANDROID_KEY_PASSWORD_VANDEBRON }}
            APP_2_ANDROID_STORE_PASSWORD_VANDEBRON: ${{ secrets.APP_2_ANDROID_STORE_PASSWORD_VANDEBRON }}
          run: bash ./env-variable-prep-android.sh
        - name: Create .env file
          working-directory: mobile
          env:
            APP: ${{ inputs.app }}
            BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}
            ENVIRONMENT: ${{inputs.environment}}
          run: bash ./env-file-prep.sh
        - name: Enable Corepack
          run: corepack enable
        - name: Setup NodeJS
          id: setup-node
          uses: actions/setup-node@v4.2.0
          with:
            node-version: 18.x
            registry-url: https://registry.npmjs.org
            cache: &#x27;yarn&#x27;
            cache-dependency-path: mobile/${{ inputs.app }}/yarn.lock
        - name: Setup Java
          uses: actions/setup-java@v4.7.0
          with:
            distribution: &#x27;temurin&#x27;
            java-version: &#x27;20&#x27;
            cache: &#x27;gradle&#x27;
        - name: Setup Android SDK  # sadly no caching capabilities here
          uses: android-actions/setup-android@v3.2.2
          with:
            log-accepted-android-sdk-licenses: false
            packages: &#x27;tools&#x27;   # Default is &#x27;tools platform-tools but we don&#x27;t need platform-tools for packaging&#x27;
        - name: Set up ruby env # Fastlane is a &quot;Ruby gem&quot;
          uses: ruby/setup-ruby@v1
          with:
            ruby-version: &#x27;3.3.0&#x27; # Changing this to 3.3 will give you &quot;Your Ruby version is 3.3.5, but your Gemfile specified 3.3.0&quot;
            bundler-cache: true
        - name: Install Gem Bundler
          working-directory: mobile/${{ inputs.app }}
          run: |
            gem install bundler
            bundle install --quiet
        # Install Dependencies
        - name: Yarn Install
          working-directory: mobile/${{ inputs.app }}
          run: yarn install --immutable
        # Build
        - name: Build App
          run: bundle exec fastlane android build
          working-directory: mobile/${{ inputs.app }}
          env:
            ENVIRONMENT: ${{ inputs.environment }}
            FASTLANE_ENV_INFERRED_BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}
            ANDROID_KEYSTORE_FILE: ${{ steps.prep-env-variables.outputs.android-keystore-file }}
            ANDROID_KEY_ALIAS: ${{ steps.prep-env-variables.outputs.android-key-alias }}
            ANDROID_STORE_PASSWORD: ${{ steps.prep-env-variables.outputs.android-store-pass }}
            ANDROID_KEY_PASSWORD: ${{ steps.prep-env-variables.outputs.android-keystore-pass }}
            FASTLANE_ANDROID_FLAVOR: ${{ steps.prep-env-variables.outputs.fastlane-android-flavor }}
        # Upload
        - name: Upload application
          uses: actions/upload-artifact@v4
          with:
            name: ${{steps.prep-env-variables.outputs.artifact-name}}
            path: &quot;mobile/${{ inputs.app }}/android/app/build/outputs/bundle/${{ steps.prep-env-variables.outputs.fastlane-android-flavor }}Release/app-${{ steps.prep-env-variables.outputs.fastlane-android-flavor }}-release.aab&quot;
            retention-days: 30
            </code></div>
          </pre>
        </td>
        <td node="[object Object]" class="Table-module__Cell">
          <pre style="font-size:0.8rem;display:flex;max-width:40vw">            <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
# file: .github/workflows/mobile-apps-build-ios.yaml
---
name: Mobile App Build for iOS
run-name: &quot;Build: iOS, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}&quot;
on:
  workflow_dispatch:
    inputs:
      app:
        description: &#x27;App&#x27;
        required: true
        type: choice
        options:
          - my-first-app
          - my-second-app
      environment:
        description: &#x27;Environment&#x27;
        required: true
        type: choice
        options:
          - test
          - acceptance
          - production
      white-label-release:
        description: &#x27;White-labeled Release?&#x27;
        type: boolean
        default: false
jobs:
  build:
    name: Build app for iOS
    runs-on: macos-latest
    environment: ${{ inputs.environment }}
    steps:
      - name: Checkout ${{ github.repository }}
        uses: actions/checkout@v4.2.2
      - name: Prep Env Variables
        id: prep-env-variables
        working-directory: mobile
        env:
          APP: ${{ inputs.app }} # my-first-app | my-second-app
          BRAND: ${{ inputs.white-label-release &amp;&amp; &#x27;other-company&#x27; || &#x27;my-company&#x27; }}
          ENVIRONMENT: ${{ inputs.environment }}  # production | test | acceptance
          APP_1_MY_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE: ${{ secrets.APP_1_MY_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE }}
          APP_1_OTHER_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE: ${{ secrets.APP_1_OTHER_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE }}
          IOS_BUILD_CERTIFICATE_P12_OTHER_COMPANY: ${{ secrets.IOS_BUILD_CERTIFICATE_P12_OTHER_COMPANY }}
          IOS_BUILD_CERTIFICATE_P12_PASSWORD_OTHER_COMPANY: ${{ secrets.IOS_BUILD_CERTIFICATE_P12_PASSWORD_OTHER_COMPANY }}
          APP_2_IOS_MOBILE_PROVISIONING_PROFILE: ${{ secrets.APP_2_IOS_MOBILE_PROVISIONING_PROFILE }}
        run: bash ./env-variable-prep-ios.sh
      - name: Create .env file
        working-directory: mobile
        env:
          APP: ${{ inputs.app }} # my-first-app | my-second-app
          BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}
          ENVIRONMENT: ${{inputs.environment}}
        run: bash ./env-file-prep.sh
      - name: Import Build Certificate from Secrets
        uses: apple-actions/import-codesign-certs@v3
        with:
          p12-file-base64: ${{ steps.prep-env-variables.outputs.ios-build-certificate-p12 }}
          p12-password: ${{ steps.prep-env-variables.outputs.ios-build-certificate-p12-password }}
      - name: Import Mobile Provisioning Profile
        uses: nickwph/apple-provisioning-profile-action@v1.0.0
        with:
          profile-base64: ${{ steps.prep-env-variables.outputs.ios-mobile-provisioning-profile }}
      - name: Setup NodeJS
        id: setup-node
        uses: actions/setup-node@v4.2.0
        with:
          node-version: 20.x
      # Mapbox v10 ships with bitcode on XCode 16 which is not allowed by the App Store
      # https://github.com/mapbox/mapbox-maps-ios/issues/2233
      # Once this issue is fixed we can upgrade to 16
      - name: Install XCode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: 15.4
      - name: Install Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.3.0
      - name: Install Bundler
        run: gem install bundler
      # TODO: Cache node_modules similarly to how Pods are cached (compare hash of yarn.lock)
      - name: Yarn Install
        working-directory: mobile/${{ inputs.app }}
        run: yarn install --immutable
      # TODO: Cache Gems similarly to how Pods are cached (compare hash of Gemfile.lock)
      - name: Install Gems
        run: bundle install
        working-directory: mobile/${{ inputs.app }}
      - name: Cache CocoaPods dependencies
        uses: actions/cache@v4
        env:
          FILES_GLOB: mobile/${{ inputs.app }}/ios/Podfile.lock
        with:
          path: |
            mobile/${{ inputs.app }}/ios/Pods
          key: ${{ runner.os }}-pods-${{ hashFiles(env.FILES_GLOB) }}
          restore-keys: |
            ${{ runner.os }}-pods-
      - name: Install Pods
        working-directory: mobile/${{ inputs.app }}/ios
        run: bundle exec pod install
      - name: Build iOS App
        env:
          APP: ${{ inputs.app }}
          SCHEME: ${{ steps.prep-env-variables.outputs.ios-scheme }}  # otherCompanyFirstAppProduction, myCompanySecondAppTest
          BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}
          TARGET: ${{ steps.prep-env-variables.outputs.ios-target }}
        run: bundle exec fastlane gym
        working-directory: mobile/${{ inputs.app }}
       # Upload
      - name: Upload application
        uses: actions/upload-artifact@v4
        with:
          name: ${{steps.prep-env-variables.outputs.ios-scheme}}
          path: &quot;mobile/${{ inputs.app }}/ios/build/${{ steps.prep-env-variables.outputs.ios-scheme }}.ipa&quot;
          retention-days: 30
          overwrite: true
          if-no-files-found: error
            </code></div>
          </pre>
        </td>
      </tr>  
    </tbody>
  </table>
<h4 class="Text-module__text-default Text-module__u-font-h4">Troubleshooting</h4>
<p class="Text-module__text-default Text-module__u-font-body" node="[object Object]">More than likely these won&#x27;t work the first time. Time to go back and adjust. Note that since the workflow is now in the main branch you can test your workflow changes on a feature branch. Just select your feature branch in the &quot;Branch&quot; dropdown shown above.</p>
<h2 class="Text-module__text-default Text-module__u-font-h2">Other Things to Note</h2>
<ol style="margin-block-start:0;margin-block-end:30px">
  <li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">App Center gives you the ability to write `appcenter-pre-build.sh` and `appcenter-post-build.sh` scripts. The `env-file-prep.sh` is basically that same thing, just without the context of appcenter.</li>
  <li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">One of our apps is using MapBox which needs a `.netrc` in the root directory. If you need something similar, you can add a step to your action by adding the code shown in the the &quot;optional mapbox&quot; part + the `./my-first-app/prep-mapbox.sh` in the [Appendix](#appendix).</li>
  <li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">After our work on this was done (and only as I&#x27;m writing this article) we realized we can use the `sparse-checkout` option from `actions/checkout` to only check out the needed files. This should speed up our workflow runtime even more!</li>
  <li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">It may be helpful for you to add the build and/or version number onto the artifact. We haven&#x27;t done that but it&#x27;s something we&#x27;re interested in adding for the future.</li>
  <li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">Troubleshooting certificates for iOS was a HUGE pain in the butt. I don&#x27;t have any good advice here other than to realize (and communicate with your POs) that this part may take a while.</li>
</ol>
<h2 class="Text-module__text-default Text-module__u-font-h2">Benefits</h2>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">It regularly took over 50 minutes for our mobile app to build in App Center. Part of that could have very likely be improved by adjusting App Center configurations &amp; how we store and bundle app assets but after migrating our builds to GitHub Actions our app build times are now down to 22 minutes - More than twice as fast!</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">All the rest of the software at Vandebron (backend services in Scala and Python and frontend applications in Typescript + React) is built using GitHub Actions. This move brings mobile apps in line with all other software. This move to GHA for mobile builds has forced several of our mobile devs to get our hands dirty in GHA which is great because we can now play a role in the larger CICD discussions.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">We have full control over our CICD pipeline for mobile builds. In the future we can integrate more Fastlane commands to further automate the release process.</li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0">We did a full ADR (shown below) which initiated the work here. Links referenced in image are in Appendix below.
<img src="../images/replacing-app-center-adr.png" alt="replace-app-center-adr" style="width:100%" node="[object Object]"/></li>
</ol>
<h2 class="Text-module__text-default Text-module__u-font-h2">Appendix</h2>
<h4 class="Text-module__text-default Text-module__u-font-h4">Mapbox Integration</h4>
<pre style="font-size:0.8rem;display:flex">  <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: .github/workflows/mobile-apps-build-android.yaml and .github/workflows/mobile-apps-build-ios.yaml (optional mapbox)
  - name: Create Mapbox .netrc file (my-first-app only)
    if: ${{ inputs.app == &#x27;my-first-app&#x27; }}
    working-directory: mobile
    env:
      MAPBOX_READ_TOKEN: ${{ secrets.MAPBOX_READ_TOKEN }}
    run: bash ./my-first-app/prep-mapbox.sh
  </code></div>
</pre>
<pre style="font-size:0.8rem;display:flex">  <div style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-bash" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
  # file: ./my-first-app/prep-mapbox.sh
  #!/usr/bin/env bash
  
  # WARN: DO NOT use tee here (it prints to console)
  {
    echo &quot;machine api.mapbox.com&quot;
    echo &quot;login mapbox&quot;
    echo &quot;password ${MAPBOX_READ_TOKEN}&quot;
  } &gt;&gt; ~/.netrc
  chmod 0600 ~/.netrc
  </code></div>
</pre>
<h4 class="Text-module__text-default Text-module__u-font-h4">ADR Links</h4>
<ol style="margin-block-start:0;margin-block-end:30px">
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><a href="https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions" node="[object Object]" style="color:inherit" target="_blank">GHA (Billing)</a></li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><a href="https://bitrise.io/" node="[object Object]" style="color:inherit" target="_blank">Bitrise</a></li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><a href="https://codemagic.io/" node="[object Object]" style="color:inherit" target="_blank">CodeMagic</a></li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><a href="https://www.youtube.com/watch?v=_uRbEyBa9q0" node="[object Object]" style="color:inherit" target="_blank">YouTube video showing GHA setup for Android</a></li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><a href="https://medium.com/scaleuptech/how-to-make-react-native-builds-with-github-actions-8d0203801eff" node="[object Object]" style="color:inherit" target="_blank">Medium article showing GHA setup for Android</a></li>
<li class="Text-module__text-default Text-module__u-font-body" style="margin-bottom:0"><a href="https://www.obytes.com/blog/react-native-ci-cd-github-action" node="[object Object]" style="color:inherit" target="_blank">Article discussing how build uploads can be done</a></li>
</ol></div></div></div><footer style="padding-top:30px;padding-bottom:30px;background-color:#363639"><div class="Container-module__container"><div class="Row-module__row Row-module__align-items-center" style="margin-bottom:15px"><div class="Col-module__col-box-sizing Col-module__col"><div><div style="cursor:pointer;user-select:none;display:flex;align-items:baseline"><svg width="140" viewBox="0 0 140 22" xmlns="http://www.w3.org/2000/svg"><path d="M9.569 21.109h-4.25L0 6.274h4.597l2.86 9.249 2.86-9.249h4.598L9.57 21.11m13.234-4.258a3.159 3.159 0 0 1 0-6.316 3.156 3.156 0 0 1 3.144 2.884v.543a3.157 3.157 0 0 1-3.144 2.889m3.2-9.81a7.38 7.38 0 1 0 0 13.3c.136.425.537.73 1.003.73h3.174V6.313h-3.174c-.466 0-.867.304-1.003.728m64.522 3.567a3.155 3.155 0 0 0-3.141 2.888v.542a3.155 3.155 0 0 0 3.14 2.885 3.16 3.16 0 0 0 3.165-3.157 3.163 3.163 0 0 0-3.164-3.158m0 10.536a7.337 7.337 0 0 1-3.195-.727 1.056 1.056 0 0 1-1.006.727h-3.171V0h4.23v7.09a7.377 7.377 0 0 1 10.522 6.676c.001 4.074-3.298 7.378-7.38 7.378m26.406-4.22a3.155 3.155 0 0 1-3.141-2.886v-.542a3.155 3.155 0 0 1 3.141-2.888 3.163 3.163 0 0 1 3.164 3.159 3.161 3.161 0 0 1-3.164 3.156m.012-10.511c-5.054 0-7.481 3.978-7.481 7.356v.025c0 3.402 2.427 7.38 7.48 7.38 5.054 0 7.48-3.978 7.48-7.38 0-3.403-2.426-7.381-7.48-7.381m-60.448 4.196a3.155 3.155 0 0 1 3.141 2.888v.542a3.156 3.156 0 0 1-3.141 2.885 3.16 3.16 0 0 1-3.165-3.157 3.163 3.163 0 0 1 3.165-3.158m0 10.536a7.377 7.377 0 0 1-7.381-7.378A7.377 7.377 0 0 1 59.635 7.09V0h4.23v21.144h-3.17c-.473 0-.866-.303-1.006-.727a7.342 7.342 0 0 1-3.195.727zm51.349-14.856v4.222a3.074 3.074 0 0 0-.244-.013c-1.64 0-3.138 1.057-3.138 2.585v8.025h-4.234V6.276h3.17c.473 0 .867.303 1.006.727a7.353 7.353 0 0 1 3.196-.727c.082 0 .162.01.244.012zm25.525 4.21c-1.467 0-2.348.886-2.348 2.584v8.09h-4.285V6.277h3.172c.472 0 .865.304 1.005.727a7.347 7.347 0 0 1 3.195-.727s1.239-.059 2.514.343c3.027.904 3.379 3.962 3.379 5.599v8.955h-4.284v-8.091c0-.883-.205-2.585-2.348-2.585zm-93.333 0c-1.467 0-2.348.886-2.348 2.584v8.09h-4.284V6.277h3.17c.474 0 .866.304 1.006.727a7.354 7.354 0 0 1 3.196-.727s1.239-.059 2.514.343c3.028.904 3.378 3.962 3.378 5.599v8.955h-4.284v-8.091c0-.883-.204-2.585-2.348-2.585zm36.24 1.755h-5.453c-.116-.003-.55-.055-.325-.637a3.336 3.336 0 0 1 6.134.093c.147.495-.246.541-.356.544m2.55-3.796c-1.308-1.384-3.145-2.214-5.284-2.214-4.254 0-7.324 3.598-7.324 7.5 0 4.15 3.398 7.398 7.399 7.398a6.789 6.789 0 0 0 3.976-1.258c1.183-.806 2.165-2.013 2.844-3.574h-4.278c-.503.73-1.208 1.31-2.542 1.31-1.635 0-3.045-.983-3.22-2.468h10.393c.327-2.566-.202-4.806-1.964-6.694" fill="#ffffff" fill-rule="evenodd"></path></svg>Â <span class="Text-module__text-default Text-module__u-font-h3 Text-module__u-font-color-green" style="font-size:28px;margin:0;line-height:auto">.tech</span></div></div></div></div><div class="Row-module__row Row-module__align-items-center"><div class="Col-module__col-box-sizing Col-module__col"><span class="Text-module__text-default" style="color:white">Â© Vandebron</span></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\n## Why GHA?\nThis seems like a lot of work... Why not go with an off-the-shelf solution from something like Bitrise or Codemagic? Fair question but not the main point of this post. To look into our reasoning check out the [Benefits](#benefits) section!\n\n## Some notes before we get started\n- We use this workflow to build two apps, one of which can be white-labeled, so we have additional `app` and `white-label-release` inputs which makes things a bit trickier. You might not need that so feel free to trim stuff down and make it your own! But for us, we why we have the `env-variable-prep-android.sh` which normalizes the variable names used for secrets so those secrets and build file names, etc. can be easily used. If you just have a single app you probably don't need this script.\n- The code below is only for the build process. Though the ADR considered how this would affect future decisions about artifact upload automation and rolling out releases for internal testing, nothing about that is automated here.\n\n## Implementation\n#### Part 1 - Basic Setup\nAdd the files below. Nothing in this setup should effect App Center but it is good to check in your changes to a branch and test those against the regular App Center build flow.\n\n  \u003ctable\u003e\n    \u003cthead style=\"position: sticky; top: 0;\"\u003e\n      \u003ctr style=\"background-color: rgba(255, 255, 255, 0.5);\"\u003e\n        \u003cth\u003eAndroid\u003c/th\u003e\n        \u003cth\u003eiOS\u003c/th\u003e\n      \u003c/tr\u003e\n    \u003c/thead\u003e\n    \u003ctbody style=\"vertical-align: top;\"\u003e\n      \u003ctr\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-yaml\"\u003e\n  # file: .github/workflows/mobile-apps-build-android.yaml\n  ---\n  name: Mobile App Build for Android\n  run-name: \"Build: Android, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}\"\n  on:\n    workflow_dispatch:\n      inputs:\n        app:\n          description: 'App'\n          required: true\n          type: choice\n          options:\n            - my-first-app\n            - my-second-app\n        environment:\n          description: 'Environment'\n          required: true\n          type: choice\n          options:\n            - test\n            - acceptance\n            - production\n        white-label-release:\n          description: 'White-labeled Release?'\n          type: boolean\n          default: false\n  jobs:\n    build:\n      name: Build app for android\n      runs-on: ubuntu-latest\n      environment: ${{ inputs.environment }}\n      steps:\n        - name: Checkout ${{ github.repository }}\n          uses: actions/checkout@v4.2.2\n        - name: Echo Input\n          env:\n            APP: ${{ inputs.app }}\n            WHITE_LABEL_RELEASE: ${{ inputs.white-label-release }}\n            ENVIRONMENT: ${{ inputs.environment }}\n          run: |\n            echo \"APP=$APP\"\n            echo \"WHITE_LABEL_RELEASE=$WHITE_LABEL_RELEASE\"\n            echo \"ENVIRONMENT=$ENVIRONMENT\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n  # file: .github/workflows/mobile-apps-build-ios.yaml\n  ---\n  name: Mobile App Build for iOS\n  run-name: \"Build: iOS, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}\"\n  on:\n    workflow_dispatch:\n      inputs:\n        app:\n          description: 'App'\n          required: true\n          type: choice\n          options:\n            - my-first-app\n            - my-second-app\n        environment:\n          description: 'Environment'\n          required: true\n          type: choice\n          options:\n            - test\n            - acceptance\n            - production\n        white-label-release:\n          description: 'White-labeled Release?'\n          type: boolean\n          default: false\n  jobs:\n    build:\n      name: Build app for iOS\n      runs-on: macos-latest\n      environment: ${{ inputs.environment }}\n      steps:\n        - name: Checkout ${{ github.repository }}\n          uses: actions/checkout@v4.2.2\n        - name: Echo Input\n          env:\n            APP: ${{ inputs.app }}\n            WHITE_LABEL_RELEASE: ${{ inputs.white-label-release }}\n            ENVIRONMENT: ${{ inputs.environment }}\n          run: |\n            echo \"APP=$APP\"\n            echo \"WHITE_LABEL_RELEASE=$WHITE_LABEL_RELEASE\"\n            echo \"ENVIRONMENT=$ENVIRONMENT\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n  # file: env-variable-prep-android.sh\n  #!/bin/bash\n  ARTIFACT_NAME=\"mobile-my-first-app-${ENVIRONMENT}-release\"\n  FASTLANE_ANDROID_FLAVOR=\"${ENVIRONMENT}\"\n  {\n    echo \"artifact-name=${ARTIFACT_NAME}\"\n    echo \"fastlane-android-flavor=${FASTLANE_ANDROID_FLAVOR}\"\n  } | tee -a \"$GITHUB_OUTPUT\"\n  # Secrets should not get sent out over tee command (which also prints it to console)\n  {\n    echo \"android-key-alias=my-first-app\"\n    echo \"android-keystore-file=../keystores/my-first-app.jks\"\n    echo \"android-keystore-pass=${ANDROID_KEY_PASSWORD}\"\n    echo \"android-store-pass=${ANDROID_STORE_PASSWORD}\"\n  } \u003e\u003e \"$GITHUB_OUTPUT\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n  # file: env-variable-prep-ios.sh\n  #!/bin/bash\n  # Secrets should not get sent out over tee command (which also prints it to console)\n  {\n    echo \"ios-mobile-provisioning-profile=${IOS_MOBILE_PROVISIONING_PROFILE}\"\n  } \u003e\u003e \"$GITHUB_OUTPUT\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n        \u003ctd colSpan=\"100%;\" style=\"width:100%\" className=\"expanded-table-cell\"\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n  # file: env-file-prep.sh\n  #!/usr/bin/env bash\n  #####################################################\n  # Creates an .env file for use in react-native-config\n  # This script should be run from the /mobile folder\n  #####################################################\n  if [ \"${ENVIRONMENT}\" != \"test\" ] \u0026\u0026 [ \"${ENVIRONMENT}\" != \"acceptance\" ] \u0026\u0026 [ \"${ENVIRONMENT}\" != \"production\" ]; then\n      echo \"ENVIRONMENT is not set, using 'production' as default.\"\n      ENVIRONMENT=production\n  fi\n  echo \"Copying 'my-first-app/.env.${ENVIRONMENT}' to 'my-first-app/.env'...\"\n  cp \"my-first-app/.env.${ENVIRONMENT}\" \"my-first-app/.env\"\n  echo \"Success!\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n  # file: ./fastlane/Fastfile\n  opt_out_usage\n  platform :android do\n    desc 'Build app for Android'\n      lane :build do\n        build_android_app(\n          task: 'bundle',\n          flavor: ENV['FASTLANE_ANDROID_FLAVOR'],\n          build_type: 'Release',\n          project_dir: 'android/',\n          print_command: true,\n          print_command_output: true,\n        )\n      end\n  end\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"display: flex; justify-content: center;\"\u003e\n  N/A for iOS\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"display: flex; justify-content: center;\"\u003e\n  N/A for Android\n          \u003c/pre\u003e\n        \u003c/td\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n  # file: ./fastlane/Gymfile\n  scheme(ENV['SCHEME'])\n  workspace(\"ios/my-first-app.xcworkspace\")\n  export_options(\"ios/exportOptions.plist\")\n  output_directory(\"ios/build\")\n  output_name(ENV['SCHEME'])\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n    \u003c/tbody\u003e\n  \u003c/table\u003e\n\n#### Part 2 - Testing your Workflow Locally\nWARNING: GitHub Actions doesn't let you run a `workflow_dispatch` action until it has been merged into the main branch so you'll want to get the basic setup above in place before you start tinkering with application logic or things that could effect App Center. Also note that while `act` is helpful for getting the basics in place, it's unlikely you'll be able to test the complete process locally because, at least for us a) Android pipeline crashes halfway through the `Build App` step with an error of `Gradle build daemon disappeared unexpectedly (it may have been killed or may have crashed)`, and b) iOS tries to install a fresh copy of Xcode\n\n  1. Follow installation instructions on [their User Guide](https://nektosact.com/installation/index.html)\n  2. Create a `~/.actrc` file that looks like this\n\n      \u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n        \u003ccode class=\"language-bash\"\u003e\n        --container-architecture linux/amd64\n        --secret GITHUB_TOKEN=$GITHUB_TOKEN\n        \u003c/code\u003e\n      \u003c/pre\u003e\n      \n  3. Get your `$GITHUB_TOKEN` env variable in place\n\n      1. Install [gh, the GitHub cli](https://cli.github.com/)\n      2. Modify shells (zsh shown below)\n\n          \u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n            export GITHUB_TOKEN=\"$(gh auth token)\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n\n      3. Close and re-open your terminal. Test to make sure you can see your `GITHUB_TOKEN` envrionment variable\n\n  4. Set up a temporary local file for secrets. WARNING: Once youâre done, remember to delete the file so itâs not hanging around on your system!! (or just donât create it in the first place unless you really need it)\n\n      \u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n        \u003ccode class=\"language-bash\"\u003e\n      # file: .secrets\n      ANDROID_STORE_PASSWORD=\"someSecr3ts\"\n      ANDROID_KEY_PASSWORD=\"YouWantQuotesBecause*s_etc.WillScrewYouUp\"\n      MAPBOX_READ_TOKEN=shhhhh.Its.asecret\n        \u003c/code\u003e\n      \u003c/pre\u003e\n\n  5. Set up a temporary local file for your workflow trigger inputs.\n\n      \u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n        \u003ccode class=\"language-json\"\u003e\n      /* file: app-input.json */\n      {\n        \"action\": \"workflow_dispatch\",\n        \"inputs\": {\n          \"app\": \"my-first-app\",\n          \"environment\": \"test\",\n          \"white-label-release\": false\n        }\n      }\n        \u003c/code\u003e\n      \u003c/pre\u003e\n\n  6. Run your workflow like this. As far as I know, you can only run the iOS workflow locally if you're on a mac. To do that you'll need to provide an additional parameter: `-P macos-latest=-self-hosted`\n\n\n  \u003ctable\u003e\n    \u003cthead style=\"position: sticky; top: 0;\"\u003e\n      \u003ctr style=\"background-color: rgba(255, 255, 255, 0.5);\"\u003e\n        \u003cth\u003eAndroid\u003c/th\u003e\n        \u003cth\u003eiOS\u003c/th\u003e\n      \u003c/tr\u003e\n    \u003c/thead\u003e\n    \u003ctbody style=\"vertical-align: top;\"\u003e\n      \u003ctr\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n        act \\\n        --workflows .github/workflows/mobile-apps-build-android.yaml \\\n        --eventpath=\"${HOME}/Documents/IT/GitHub Actions/Mobile Apps/app-input.json\" \\\n        --secret-file=\"${HOME}/Documents/IT/GitHub Actions/Mobile Apps/.secrets\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n        act -P macos-latest=-self-hosted \\\n        --workflows .github/workflows/mobile-apps-build-ios.yaml \\\n        --eventpath=\"${HOME}/Documents/IT/GitHub Actions/Mobile Apps/app-input.json\" \\\n        --secret-file=\"${HOME}/Documents/IT/GitHub Actions/Mobile Apps/.secrets\"\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e\n    \u003c/tbody\u003e\n  \u003c/table\u003e\n\n#### Part 3 - Testing Things out from GHA\n\n1. Once you're happy with your changes locally, send a PR \u0026 merge them in! Remember this is only the basic setup to get the action avaible from the GitHub Actions interface so maybe leave a comment in the PR notifying your teammates about how they should expect a follow-up PR\n\n2. Go to the \"Actions\" tab at the top of your GitHub repo. You should now see your actions for building iOS and Android on the left. Since it's a `workflow_dispatch` action you'll trigger the actions manually.\n\n    \u003cdiv\u003e\n      \u003cimg src=\"../images/replacing-app-center-run-workflow.png\" alt=\"run-workflow\" style=\"width: 500px;\"/\u003e\n    \u003c/div\u003e\n\n#### Part 4 - Implement the Full Workflow for iOS and Android\nAdjust the files below. This is where you may end up needing to modify things that affect your App Center build. Try to keep them to a mimimum so you can still use App Center for builds should anything here not work as expected.\n\n  \u003ctable\u003e\n    \u003cthead style=\"position: sticky; top: 0;\"\u003e\n      \u003ctr style=\"background-color: rgba(255, 255, 255, 0.5);\"\u003e\n        \u003cth\u003eAndroid\u003c/th\u003e\n        \u003cth\u003eiOS\u003c/th\u003e\n      \u003c/tr\u003e\n    \u003c/thead\u003e\n    \u003ctbody style=\"vertical-align: top;\"\u003e\n      \u003ctr\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-yaml\"\u003e\n  # file: .github/workflows/mobile-apps-build-android.yaml\n  ---\n  name: Mobile App Build for Android\n  run-name: \"Build: android, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}\"\n  on:\n    workflow_dispatch:\n      inputs:\n        app:\n          description: 'App'\n          required: true\n          type: choice\n          options:\n            - my-first-app\n            - my-second-app\n        environment:\n          description: 'Environment'\n          required: true\n          type: choice\n          options:\n            - test\n            - acceptance\n            - production\n        white-label-release:\n          description: 'White-labeled Release?'\n          type: boolean\n          default: false\n  jobs:\n    build:\n      name: Build app for android\n      runs-on: ubuntu-latest\n      environment: ${{ inputs.environment }}\n      steps:\n        - name: Checkout ${{ github.repository }}\n          uses: actions/checkout@v4.2.2\n        - name: Prep Env Variables\n          id: prep-env-variables\n          working-directory: mobile\n          env:\n            APP: ${{ inputs.app }} # my-first-app | my-second-app\n            ENVIRONMENT: ${{ inputs.environment }}  # production | test | acceptance\n            BRAND: ${{ inputs.white-label-release \u0026\u0026 'other-company' || 'my-company' }}\n            APP_1_ANDROID_KEY_PASSWORD_VANDEBRON: ${{ secrets.APP_1_ANDROID_KEY_PASSWORD_VANDEBRON }}\n            APP_1_ANDROID_STORE_PASSWORD_VANDEBRON: ${{ secrets.APP_1_ANDROID_STORE_PASSWORD_VANDEBRON }}\n            APP_1_ANDROID_KEY_PASSWORD_WHITE_LABEL: ${{ secrets.APP_1_ANDROID_KEY_PASSWORD_WHITE_LABEL }}\n            APP_1_ANDROID_STORE_PASSWORD_WHITE_LABEL: ${{ secrets.APP_1_ANDROID_STORE_PASSWORD_WHITE_LABEL }}\n            APP_2_ANDROID_KEY_PASSWORD_VANDEBRON: ${{ secrets.APP_2_ANDROID_KEY_PASSWORD_VANDEBRON }}\n            APP_2_ANDROID_STORE_PASSWORD_VANDEBRON: ${{ secrets.APP_2_ANDROID_STORE_PASSWORD_VANDEBRON }}\n          run: bash ./env-variable-prep-android.sh\n        - name: Create .env file\n          working-directory: mobile\n          env:\n            APP: ${{ inputs.app }}\n            BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}\n            ENVIRONMENT: ${{inputs.environment}}\n          run: bash ./env-file-prep.sh\n        - name: Enable Corepack\n          run: corepack enable\n        - name: Setup NodeJS\n          id: setup-node\n          uses: actions/setup-node@v4.2.0\n          with:\n            node-version: 18.x\n            registry-url: https://registry.npmjs.org\n            cache: 'yarn'\n            cache-dependency-path: mobile/${{ inputs.app }}/yarn.lock\n        - name: Setup Java\n          uses: actions/setup-java@v4.7.0\n          with:\n            distribution: 'temurin'\n            java-version: '20'\n            cache: 'gradle'\n        - name: Setup Android SDK  # sadly no caching capabilities here\n          uses: android-actions/setup-android@v3.2.2\n          with:\n            log-accepted-android-sdk-licenses: false\n            packages: 'tools'   # Default is 'tools platform-tools but we don't need platform-tools for packaging'\n        - name: Set up ruby env # Fastlane is a \"Ruby gem\"\n          uses: ruby/setup-ruby@v1\n          with:\n            ruby-version: '3.3.0' # Changing this to 3.3 will give you \"Your Ruby version is 3.3.5, but your Gemfile specified 3.3.0\"\n            bundler-cache: true\n        - name: Install Gem Bundler\n          working-directory: mobile/${{ inputs.app }}\n          run: |\n            gem install bundler\n            bundle install --quiet\n        # Install Dependencies\n        - name: Yarn Install\n          working-directory: mobile/${{ inputs.app }}\n          run: yarn install --immutable\n        # Build\n        - name: Build App\n          run: bundle exec fastlane android build\n          working-directory: mobile/${{ inputs.app }}\n          env:\n            ENVIRONMENT: ${{ inputs.environment }}\n            FASTLANE_ENV_INFERRED_BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}\n            ANDROID_KEYSTORE_FILE: ${{ steps.prep-env-variables.outputs.android-keystore-file }}\n            ANDROID_KEY_ALIAS: ${{ steps.prep-env-variables.outputs.android-key-alias }}\n            ANDROID_STORE_PASSWORD: ${{ steps.prep-env-variables.outputs.android-store-pass }}\n            ANDROID_KEY_PASSWORD: ${{ steps.prep-env-variables.outputs.android-keystore-pass }}\n            FASTLANE_ANDROID_FLAVOR: ${{ steps.prep-env-variables.outputs.fastlane-android-flavor }}\n        # Upload\n        - name: Upload application\n          uses: actions/upload-artifact@v4\n          with:\n            name: ${{steps.prep-env-variables.outputs.artifact-name}}\n            path: \"mobile/${{ inputs.app }}/android/app/build/outputs/bundle/${{ steps.prep-env-variables.outputs.fastlane-android-flavor }}Release/app-${{ steps.prep-env-variables.outputs.fastlane-android-flavor }}-release.aab\"\n            retention-days: 30\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n        \u003ctd\u003e\n          \u003cpre style=\"font-size: 0.8rem; display: flex; max-width: 40vw;\"\u003e\n            \u003ccode class=\"language-bash\"\u003e\n# file: .github/workflows/mobile-apps-build-ios.yaml\n---\nname: Mobile App Build for iOS\nrun-name: \"Build: iOS, ${{ inputs.app }}, ${{ inputs.environment }}, white-label-release=${{ inputs.white-label-release }}\"\non:\n  workflow_dispatch:\n    inputs:\n      app:\n        description: 'App'\n        required: true\n        type: choice\n        options:\n          - my-first-app\n          - my-second-app\n      environment:\n        description: 'Environment'\n        required: true\n        type: choice\n        options:\n          - test\n          - acceptance\n          - production\n      white-label-release:\n        description: 'White-labeled Release?'\n        type: boolean\n        default: false\njobs:\n  build:\n    name: Build app for iOS\n    runs-on: macos-latest\n    environment: ${{ inputs.environment }}\n    steps:\n      - name: Checkout ${{ github.repository }}\n        uses: actions/checkout@v4.2.2\n      - name: Prep Env Variables\n        id: prep-env-variables\n        working-directory: mobile\n        env:\n          APP: ${{ inputs.app }} # my-first-app | my-second-app\n          BRAND: ${{ inputs.white-label-release \u0026\u0026 'other-company' || 'my-company' }}\n          ENVIRONMENT: ${{ inputs.environment }}  # production | test | acceptance\n          APP_1_MY_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE: ${{ secrets.APP_1_MY_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE }}\n          APP_1_OTHER_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE: ${{ secrets.APP_1_OTHER_COMPANY_IOS_MOBILE_PROVISIONING_PROFILE }}\n          IOS_BUILD_CERTIFICATE_P12_OTHER_COMPANY: ${{ secrets.IOS_BUILD_CERTIFICATE_P12_OTHER_COMPANY }}\n          IOS_BUILD_CERTIFICATE_P12_PASSWORD_OTHER_COMPANY: ${{ secrets.IOS_BUILD_CERTIFICATE_P12_PASSWORD_OTHER_COMPANY }}\n          APP_2_IOS_MOBILE_PROVISIONING_PROFILE: ${{ secrets.APP_2_IOS_MOBILE_PROVISIONING_PROFILE }}\n        run: bash ./env-variable-prep-ios.sh\n      - name: Create .env file\n        working-directory: mobile\n        env:\n          APP: ${{ inputs.app }} # my-first-app | my-second-app\n          BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}\n          ENVIRONMENT: ${{inputs.environment}}\n        run: bash ./env-file-prep.sh\n      - name: Import Build Certificate from Secrets\n        uses: apple-actions/import-codesign-certs@v3\n        with:\n          p12-file-base64: ${{ steps.prep-env-variables.outputs.ios-build-certificate-p12 }}\n          p12-password: ${{ steps.prep-env-variables.outputs.ios-build-certificate-p12-password }}\n      - name: Import Mobile Provisioning Profile\n        uses: nickwph/apple-provisioning-profile-action@v1.0.0\n        with:\n          profile-base64: ${{ steps.prep-env-variables.outputs.ios-mobile-provisioning-profile }}\n      - name: Setup NodeJS\n        id: setup-node\n        uses: actions/setup-node@v4.2.0\n        with:\n          node-version: 20.x\n      # Mapbox v10 ships with bitcode on XCode 16 which is not allowed by the App Store\n      # https://github.com/mapbox/mapbox-maps-ios/issues/2233\n      # Once this issue is fixed we can upgrade to 16\n      - name: Install XCode\n        uses: maxim-lobanov/setup-xcode@v1\n        with:\n          xcode-version: 15.4\n      - name: Install Ruby\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: 3.3.0\n      - name: Install Bundler\n        run: gem install bundler\n      # TODO: Cache node_modules similarly to how Pods are cached (compare hash of yarn.lock)\n      - name: Yarn Install\n        working-directory: mobile/${{ inputs.app }}\n        run: yarn install --immutable\n      # TODO: Cache Gems similarly to how Pods are cached (compare hash of Gemfile.lock)\n      - name: Install Gems\n        run: bundle install\n        working-directory: mobile/${{ inputs.app }}\n      - name: Cache CocoaPods dependencies\n        uses: actions/cache@v4\n        env:\n          FILES_GLOB: mobile/${{ inputs.app }}/ios/Podfile.lock\n        with:\n          path: |\n            mobile/${{ inputs.app }}/ios/Pods\n          key: ${{ runner.os }}-pods-${{ hashFiles(env.FILES_GLOB) }}\n          restore-keys: |\n            ${{ runner.os }}-pods-\n      - name: Install Pods\n        working-directory: mobile/${{ inputs.app }}/ios\n        run: bundle exec pod install\n      - name: Build iOS App\n        env:\n          APP: ${{ inputs.app }}\n          SCHEME: ${{ steps.prep-env-variables.outputs.ios-scheme }}  # otherCompanyFirstAppProduction, myCompanySecondAppTest\n          BRAND: ${{ steps.prep-env-variables.outputs.inferred-brand }}\n          TARGET: ${{ steps.prep-env-variables.outputs.ios-target }}\n        run: bundle exec fastlane gym\n        working-directory: mobile/${{ inputs.app }}\n       # Upload\n      - name: Upload application\n        uses: actions/upload-artifact@v4\n        with:\n          name: ${{steps.prep-env-variables.outputs.ios-scheme}}\n          path: \"mobile/${{ inputs.app }}/ios/build/${{ steps.prep-env-variables.outputs.ios-scheme }}.ipa\"\n          retention-days: 30\n          overwrite: true\n          if-no-files-found: error\n            \u003c/code\u003e\n          \u003c/pre\u003e\n        \u003c/td\u003e\n      \u003c/tr\u003e  \n    \u003c/tbody\u003e\n  \u003c/table\u003e\n\n#### Troubleshooting\nMore than likely these won't work the first time. Time to go back and adjust. Note that since the workflow is now in the main branch you can test your workflow changes on a feature branch. Just select your feature branch in the \"Branch\" dropdown shown above.\n\n## Other Things to Note\n\n\u003cul\u003e\n  \u003cli\u003eApp Center gives you the ability to write `appcenter-pre-build.sh` and `appcenter-post-build.sh` scripts. The `env-file-prep.sh` is basically that same thing, just without the context of appcenter.\u003c/li\u003e\n  \u003cli\u003eOne of our apps is using MapBox which needs a `.netrc` in the root directory. If you need something similar, you can add a step to your action by adding the code shown in the the \"optional mapbox\" part + the `./my-first-app/prep-mapbox.sh` in the [Appendix](#appendix).\u003c/li\u003e\n  \u003cli\u003eAfter our work on this was done (and only as I'm writing this article) we realized we can use the `sparse-checkout` option from `actions/checkout` to only check out the needed files. This should speed up our workflow runtime even more!\u003c/li\u003e\n  \u003cli\u003eIt may be helpful for you to add the build and/or version number onto the artifact. We haven't done that but it's something we're interested in adding for the future.\u003c/li\u003e\n  \u003cli\u003eTroubleshooting certificates for iOS was a HUGE pain in the butt. I don't have any good advice here other than to realize (and communicate with your POs) that this part may take a while.\u003c/li\u003e\n\u003c/ul\u003e\n\n## Benefits\n- It regularly took over 50 minutes for our mobile app to build in App Center. Part of that could have very likely be improved by adjusting App Center configurations \u0026 how we store and bundle app assets but after migrating our builds to GitHub Actions our app build times are now down to 22 minutes - More than twice as fast!\n- All the rest of the software at Vandebron (backend services in Scala and Python and frontend applications in Typescript + React) is built using GitHub Actions. This move brings mobile apps in line with all other software. This move to GHA for mobile builds has forced several of our mobile devs to get our hands dirty in GHA which is great because we can now play a role in the larger CICD discussions.\n- We have full control over our CICD pipeline for mobile builds. In the future we can integrate more Fastlane commands to further automate the release process.\n- We did a full ADR (shown below) which initiated the work here. Links referenced in image are in Appendix below.\n  ![replace-app-center-adr](../images/replacing-app-center-adr.png)\n\n\n## Appendix\n\n#### Mapbox Integration\n\u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n  \u003ccode class=\"language-bash\"\u003e\n  # file: .github/workflows/mobile-apps-build-android.yaml and .github/workflows/mobile-apps-build-ios.yaml (optional mapbox)\n  - name: Create Mapbox .netrc file (my-first-app only)\n    if: ${{ inputs.app == 'my-first-app' }}\n    working-directory: mobile\n    env:\n      MAPBOX_READ_TOKEN: ${{ secrets.MAPBOX_READ_TOKEN }}\n    run: bash ./my-first-app/prep-mapbox.sh\n  \u003c/code\u003e\n\u003c/pre\u003e\n\n\n\u003cpre style=\"font-size: 0.8rem; display: flex;\"\u003e\n  \u003ccode class=\"language-bash\"\u003e\n  # file: ./my-first-app/prep-mapbox.sh\n  #!/usr/bin/env bash\n  \n  # WARN: DO NOT use tee here (it prints to console)\n  {\n    echo \"machine api.mapbox.com\"\n    echo \"login mapbox\"\n    echo \"password ${MAPBOX_READ_TOKEN}\"\n  } \u003e\u003e ~/.netrc\n  chmod 0600 ~/.netrc\n  \u003c/code\u003e\n\u003c/pre\u003e\n\n#### ADR Links\n- [GHA (Billing)](https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions)\n- [Bitrise](https://bitrise.io/)\n- [CodeMagic](https://codemagic.io/)\n- [YouTube video showing GHA setup for Android](https://www.youtube.com/watch?v=_uRbEyBa9q0)\n- [Medium article showing GHA setup for Android](https://medium.com/scaleuptech/how-to-make-react-native-builds-with-github-actions-8d0203801eff)\n- [Article discussing how build uploads can be done](https://www.obytes.com/blog/react-native-ci-cd-github-action)","meta":{"title":"Finding a Replacement for App Center","description":"App Center is closing up shop on March 31st, 2025 so what's the plan for building mobile apps at Vandebron?","createdAt":"Sat Jan 25 2025 00:00:00 GMT+0000 (Coordinated Universal Time)","coverImage":"images/replacing-app-center-building-a-phone.jpg","tags":["reactnative","App Aenter","GHA"],"author":"John Fisher \u0026 Arnav Mundkur","slug":"blog/replacing-app-center","formattedDate":"25 januari 2025","date":"Sat Jan 25 2025 00:00:00 GMT+0000 (Coordinated Universal Time)"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"replacing-app-center"},"buildId":"rZbcDLMLTeqylYanQZQZN","assetPrefix":"/pr-preview/pr-52","isFallback":false,"gsp":true}</script><script nomodule="" src="/pr-preview/pr-52/_next/static/chunks/polyfills-28654a8145d7603786fc.js"></script><script src="/pr-preview/pr-52/_next/static/chunks/webpack-0b9cc56c94819e8023ea.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/framework.87b9127d6cd191ae1c9a.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.e863e97795daa2195b5e.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/main-419ac17f185f95278b96.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/7b9503d2.4af90216c47085b5c8e9.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/645636b0.a83a6a4548b93404854d.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/226daff62b2d4bc1e9a7210a7f6000a544319a74.fbdd4d016a5c47ddc9db.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/pages/_app-4af7ffd42c025008877f.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/1c49f5f00355f650bee3d37484f094be037a30fa.c32ba6a52f424c1ca4c3.js" async=""></script><script src="/pr-preview/pr-52/_next/static/chunks/pages/blog/%5Bslug%5D-3fa11fb8931c3ce2a9d9.js" async=""></script><script src="/pr-preview/pr-52/_next/static/rZbcDLMLTeqylYanQZQZN/_buildManifest.js" async=""></script><script src="/pr-preview/pr-52/_next/static/rZbcDLMLTeqylYanQZQZN/_ssgManifest.js" async=""></script></body></html>